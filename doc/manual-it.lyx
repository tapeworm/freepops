#LyX 1.3 created this file. For more info see http://www.lyx.org/
\lyxformat 221
\textclass article
\begin_preamble
\usepackage{graphicx}
\end_preamble
\language english
\inputencoding auto
\fontscheme bookman
\graphics default
\paperfontsize 12
\spacing single 
\papersize a4paper
\paperpackage widemarginsa4
\use_geometry 0
\use_amsmath 0
\use_natbib 0
\use_numerical_citations 0
\paperorientation portrait
\secnumdepth 3
\tocdepth 3
\paragraph_separation indent
\defskip medskip
\quotes_language english
\quotes_times 2
\papercolumns 1
\papersides 1
\paperpagestyle fancy

\layout Standard


\begin_inset ERT
status Collapsed

\layout Standard

\backslash 
thispagestyle{empty}
\layout Standard

\backslash 
vspace*{5cm}
\layout Standard

\backslash 
begin{flushright}
\backslash 
huge{FreePOPs Manual}
\layout Standard

\backslash 
vspace{-6mm}
\layout Standard

\backslash 
rule{15cm}{2mm}
\layout Standard

\backslash 
vspace{2mm}
\layout Standard

\backslash 
normalsize{Scritto da Enrico Tassi, Nicola Cocchiaro}
\layout Standard

\backslash 
vspace{1cm}
\layout Standard
$Date$
\layout Standard
$Revision$
\layout Standard

\backslash 
end{flushright}
\layout Standard

\backslash 
vspace{
\backslash 
stretch{1}}
\layout Standard

\backslash 
hspace{
\backslash 
stretch{1}}Documento rilasciato sotto la licenza GNU/FDL.
\backslash 
hspace{
\backslash 
stretch{1}}
\layout Standard

\backslash 
pagebreak
\end_inset 


\layout Standard


\begin_inset LatexCommand \tableofcontents{}

\end_inset 


\layout Standard


\begin_inset ERT
status Collapsed

\layout Standard

\backslash 
newpage
\end_inset 


\layout Section

Introduzione
\layout Standard

FreePOPs è un demone POP3 più un interprete LUA e alcune librerie extra
 per il parsing di HTTP e HTML.
 Il suo scopo principale è tradurre richieste POP3 locali in azioni HTTP
 remote per le webmail supportate, ma in realta' è più flessibile di cosi':
 per esempio esiste un plugin per leggere news da un sito web come se fossero
 messaggi in una mailbox.
 Si può facilmente estendere FreePOPs al volo, senza neanche farlo ripartire;
 si può aggiungere un plugin o modificarne uno esistente semplicemente cambiando
 uno script, dato che i plugin sono scritti in LUA e sono interpretati al
 volo.
\layout Subsection

Situazioni d'uso
\layout Standard

FreePOPs può essere utile in molte situazioni, qui descriviamo le più ovvie:
\layout Itemize

Siete dietro un firewall che chiude la porta 110 ma volete comunque leggere
 la posta elettronica e la webmail del vostro provider fa schifo.
\layout Itemize

Il vostro mail provider non vi permette di accedere alla mailbox con il
 protocollo POP3 ma solo tramite il servizio di webmail.
\layout Itemize

Preferite usare la vostra mailbox invece di sfogliare le news di un qualche
 sito.
\layout Itemize

Dovete sviluppare un server POP3 in meno di una settimana e volete che sia
 ragionevolmente veloce e che non consumi molta memoria.
\layout Itemize

Non siete hacker del C, ma volete trarre beneficio da un frontend ad un
 server POP3, veloce e scritto in C, ma non volete perdere un mese a scrivere
 il backend in C.
 LUA è un linguaggio davvero semplice e leggero, una settimana è abbastanza
 per impararlo e poterlo usare in modo produttivo.
\layout Subsection

Feature
\layout Standard

FreePOPs è l'unico software che conosciamo con queste feature:
\layout Itemize

Server POP3 compliant con RFC (non con tutte le feature, ma compliant).
\layout Itemize

Portabile (scritto in C e LUA il quale è scritto in C, quindi tutto è scritto
 nel linguaggio più portabile del mondo).
\layout Itemize

Piccolo (in termini di risorse utilizzate) e ragionevolmente veloce.
\layout Itemize

Estremamente estendibile al volo mediante un linguaggio semplice e potente.
\layout Itemize

Piuttosto documentato.
\layout Itemize

Rilasciato sotto la licenza GNU/GPL (questo significa che FreePOPs è Software
 Libero).
\layout Subsection

Plugin
\layout Standard

Questi sono i plugin correntemente inclusi in FreePOPs:
\layout Description

libero.lua Questo plugin supporta in pieno la webmail di 
\family typewriter 
www.libero.it
\family default 
 per mailbox con domini come 
\family typewriter 
@libero.it
\family default 
, 
\family typewriter 
@iol.it
\family default 
, 
\family typewriter 
@inwind.it
\family default 
, 
\family typewriter 
@blu.it
\family default 
.
\layout Description

tin.lua Questo plugin supporta in pieno la webmail di 
\family typewriter 
communicator.virgilio.it
\family default 
 per mailbox con domini come 
\family typewriter 
@tin.it
\family default 
, 
\family typewriter 
@virgilio.it
\family default 
.
\layout Description

lycos.lua Questo plugin supporta la webmail 
\family typewriter 
mail.lycos.it
\family default 
 per mailbox col dominio 
\family typewriter 
@lycos.it.
\layout Description

popforward.lua Questo è un plugin usato principalmente per testare moduli
 di FreePOPs.
 Esso agisce come un forward POP3, semplicemente si comporta come mediatore
 tra voi ed un vero server POP3.
 Questo plugin ci ha permesso di testare FreePOPs senza avere alcun vero
 plugin gia' scritto.
 Potreste usarlo per mascherare un server POP3 con molti bug che può venire
 facilmente compromesso grazie a richieste malevole.
 Ovviamente suggeriamo di esaminare per bene questo plugin, e fare un po'
 di hacking per prevenire richieste malevole al vostro server.
\layout Description

aggregator.lua Molti siti forniscono un backend RSS per indicizzare le loro
 news.
 Questo plugin fa si' che RSS si comporti come una mailbox in cui potete
 trovare una mail per ogni news.
\layout Description

flatnuke.lua Questo è un aggregator più potente per siti basati sul CMS FlatNuke,
 e permette il download dell'intero corpo delle news.
\begin_inset Foot
collapsed true

\layout Standard

Vedete HTTP://flatnuke.sourceforge.net per l'homepage del progetto
\end_inset 


\layout Description

kernel.lua Questo è un plugin per tenersi aggiornati sulle ultime versioni
 del kernel Linux.
\layout Description

gmail.lua Questo plugin supporta la mailbox su 
\family typewriter 
gmail.google.com
\family default 
 per mailbox col dominio 
\family typewriter 
@gmail.com.
\layout Section

Storia
\layout Standard

FreePOPs non nasce dal nulla.
 Un progetto simile (solo nella situazione d'uso principale) è LiberoPOPs.
 
\layout Standard

L'antenato di FreePOPs è completamente scritto in C per ragioni poco interessant
i.
 LiberoPOPs supporta 
\begin_inset Quotes eld
\end_inset 

plugin
\begin_inset Quotes erd
\end_inset 

 ma in maniera più statica e complessa.
 Il frontend al server POP3 potrebbe essere collegato ad un backend scritto
 in C, questo significa che dovreste ricompilare e far ripartire LiberoPOPs
 ogni volta che cambiate una riga in un plugin.
 Un altro punto interessante è che LiberoPOPs era stato creato dal nulla
 in un tempo molto breve (dovete essere Italiani e usare un indirizzo di
 posta 
\family typewriter 
@libero.it
\family default 
 per capire perché), ciò vuol dire che era nato con molti bug e FIX-ME nel
 codice.
 
\layout Standard

Il progetto LiberoPOPs ebbe un rapido successo, perché tutti ne avevano
 bisogno, quindi avevamo molti utenti.
 Nella filosofia della comunita' opensource (e anche di Linux) devi rilasciare
 il software frequentemente, e questo è ciò che facevamo: rilasciavamo nuove
 versioni ogni due giorni.
 Non avevamo a che fare con utenti Unix, nè hacker, ma per la maggior parte
 utenti Win32.
 Ad un certo punto capimmo che questi erano pigri/stufi di aggiornare il
 software ogni due giorni.
 Il brutto mondo Win insegna che il software si auto-aggiorna, si auto-installa
 e probabilmente si auto-scrive.
 
\layout Standard

Cercammo di risolvere il problema tirando fuori dal motore in C la maggior
 parte del codice che cambiava più spesso, ma questo era molto difficile
 visto che il C non è pensato per questo genere di cose.
 Una volta che LiberoPOPs si fu stabilizzato iniziammo a pensare a come
 risolvere meglio la cosa.
 
\layout Standard

Un linguaggio di scripting/interpretato sembro' una buona scelta e dopo
 una lunga ricerca in rete e nei newsgroup universitari trovai LUA..
 Questo non è il luogo per dire al mondo quanto sia bello questo linguaggio
 quindi non ne parlero' oltre qui.
 Integrare l'interprete LUA in LiberoPOPs non fu cosi' difficile e FreePOPs
 ne è il risultato.
 Ora è davvero più facile scrivere/testare un plugin e (anche se non è ancora
 implementato) un sistema di auto-aggiornamento è molto facile da scrivere
 dato che non c'è bisogno di ricompilare il nucleo C in quasi nessun caso.
\layout Section

File di configurazione di FreePOPs
\layout Standard

FreePOPs non ha bisogno di una vera configurazione.
 La maggior parte degli utenti non dovrebbe modificare il file di configurazione.
 Se siete sviluppatori o utenti curiosi il file di configurazione è 
\family typewriter 
config.lua
\family default 
, che si trova nella directory del programma sotto win32 o in  
\family typewriter 
/etc/freepops/
\family default 
 in ambiente posix.
\layout Standard

Più avanti vedremo come i plugin sono associati al dominio di un indirizzo
  di posta, e alcuni di questi plugin hanno alias per altri domini per rendere
  più facile la raccolta di news da alcuni siti.
 Leggete la documentazione dei plugin per maggiori informazioni su di essi,
 e  magari inviate una mail con il vostro nuovo alias se volete che venga
  integrato nella prossima versione di FreePOPs.
\layout Standard

Dalla versione 0.0.11 il file 
\family typewriter 
config.lua
\family default 
 ha una sezione policy.
 In questa sezione potete escludere o accettare classi di indirizzi mail.
 Questo può essere utile ad amministratori di rete.
\layout Section

Parametri a riga di comando di FreePOPs
\layout Standard

La vera configurazione di FreePOPs viene impostata tramite argomenti a riga
  di comando.
 Questi sono descritti in dettaglio nelle pagine del man in  ambienti Unix
 e qui di seguito.
 Tenete presente che in condizioni d'uso normali non serve specificare niente
 per usare FreePOPs, ma in caso di esigenze specifiche è bene fare riferimento
 a questo elenco:
\layout Description

-p\SpecialChar ~
<port>,\SpecialChar ~
--port\SpecialChar ~
<port> Per default FreePOPs fa bind sulla porta 2000.
 Per modificare questo comportamento basta usare questo switch.
\layout Description

-t\SpecialChar ~
<num>,\SpecialChar ~
--threads\SpecialChar ~
<num> FreePOPs può gestire connessioni multiple, fino a
 
\emph on 
num
\emph default 
.
 Il default è 5.
\layout Description

-b\SpecialChar ~

\series bold 
addr,
\series default 
\SpecialChar ~

\series bold 
--bind
\series default 
\SpecialChar ~

\series bold 
addr
\series default 
 Per fare bind su 
\emph on 
addr
\emph default 
 invece che INADDR_ANY (0.0.0.0).
 
\emph on 
addr
\emph default 
 deve essere una stringa contenente un indirizzo IPv4 nel formato 
\begin_inset Quotes eld
\end_inset 

ddd.ddd.ddd.ddd
\begin_inset Quotes erd
\end_inset 

, o un nome host.
\layout Description

-l\SpecialChar ~

\series bold 
logfacility,
\series default 
\SpecialChar ~

\series bold 
--logmode
\series default 
\SpecialChar ~

\series bold 
logfacility
\series default 
 Può essere usato per specificare il tipo di logging.
 
\emph on 
logfacility
\emph default 
 può essere 
\begin_inset Quotes eld
\end_inset 

stdout
\begin_inset Quotes erd
\end_inset 

 per standard output (il default), 
\begin_inset Quotes eld
\end_inset 

syslog
\begin_inset Quotes erd
\end_inset 

 per usare un demone di logging o un nome di file valido per avere un log
 su file.
\layout Description

-d,\SpecialChar ~

\series bold 
--daemonize
\series default 
 Sposta il processo in background rilasciando la tty.
\layout Description

-P\SpecialChar ~
<host>:<port>,\SpecialChar ~
--proxy\SpecialChar ~
<host>:<port> Per dire a FreePOPs quale è il vostro
 proxy HTTP.
 Se 
\emph on 
port
\emph default 
 non è impostato viene usata la porta 8080 di default.
\layout Description

-A\SpecialChar ~
<username>:<password>,\SpecialChar ~
--auth\SpecialChar ~
<username>:<password> Si usa per proxy con
 autenticazione, per specificare nome utente e password.
 Va usato con 
\emph on 
-P
\emph default 
 o la sua forma estesa.
\layout Description

-u\SpecialChar ~
name,\SpecialChar ~
--useragent\SpecialChar ~
name Imposta lo useragent da usare nelle connessioni HTTP.
 Il default è 
\begin_inset Quotes eld
\end_inset 

Firefox/0.8
\begin_inset Quotes erd
\end_inset 

.
\layout Description

-s\SpecialChar ~
user.group,\SpecialChar ~
--suid\SpecialChar ~
user.group Lascia i privilegi di root dopo il bind.
 Se lanciato da utente normale non serve questa opzione.
\layout Description

-h,\SpecialChar ~
--help Stampa un messaggio di aiuto.
\layout Description

-v,\SpecialChar ~
--verbose,\SpecialChar ~
-w,\SpecialChar ~
--veryverbose Questo dice a FreePOPs di loggare alcune informazi
oni utili per  riportare bug.
\layout Standard

In ambienti posix come Debian GNU/Linux potete avviare FreePOPs al boot
 come  servizio standard.
 In questo caso gli switch a riga di comando sono memorizzati in 
\family typewriter 
/etc/default/freepops
\family default 
, in alcuni sistemi basati su rpm dovreste trovare lo stesso file con nome
 
\family typewriter 
/etc/sysconfig/freepops
\family default 
.
\layout Section

Configurazione del client email
\layout Standard

Per configurare il client email dovete cambiare le impostazioni del server
 POP3.
 Solitamente dovrete usare 
\emph on 
localhost
\emph default 
 come nome del server POP3 e 
\emph on 
2000
\emph default 
 come porta.
 Nel caso in cui installiate FreePOPs in un altro computer della vostra
 LAN, dovreste usare il nome di quell'host invece di localhost, mentre nel
 caso in cui abbiate cambiato la porta di default con lo switch 
\family typewriter 
-p
\family default 
 dovrete immettere la stessa porta anche nel client email..
 Dovete sempre usare come nome utente l'indirizzo di posta completo, per
 esempio 
\family typewriter 
qualcosa@libero.it
\family default 
 invece che solo 
\family typewriter 
qualcosa
\family default 
.
 Questo è perché FreePOPs sceglie il plugin da caricare guardando al nome
 utente che deve quindi contenere tutte le informazioni.
 Più sotto presentiamo tutti i plugin e i loro domini associati e mostriamo
 come sia possibile creare binding al volo tra un indirizzo email e un dominio.
\layout Subsection

Tutorial per Outlook Express
\layout Standard

Mostriamo qui come configurare Outlook Express in ambienti Windows per l'uso
 con FreePOPs.
 Altri client si configurano più o meno allo stesso modo.
\layout Itemize

Dal menu 
\series bold 
Strumenti
\series default 
 seleziona la voce 
\series bold 
Account...
\layout Standard


\begin_inset Graphics
	filename main.ps
	lyxscale 50
	scale 80
	keepAspectRatio

\end_inset 


\layout Itemize

Seleziona il tuo account e clicca su 
\series bold 
Proprietà
\layout Standard


\begin_inset Graphics
	filename settings.ps
	lyxscale 50
	scale 80
	keepAspectRatio

\end_inset 


\layout Itemize

Nella linguetta 
\series bold 
Server
\series default 
 metti in 
\series bold 
Posta in arrivo
\series default 
 il nome del computer su cui hai eseguito FreePOPs, solitamente 
\emph on 
localhost
\emph default 
.
 Il 
\series bold 
Nome account
\series default 
 deve essere il tuo indirizzo di mail completo, seguito dal dominio al quale
 appartiene la tua email, ad esempio 
\family typewriter 
nomeutente@dominio.it
\family default 
.
\layout Standard


\begin_inset Graphics
	filename server.ps
	lyxscale 50
	scale 80
	keepAspectRatio

\end_inset 


\layout Itemize

Nella linguetta 
\series bold 
Impostazioni avanzate
\series default 
 metti in 
\series bold 
Posta in arrivo
\series default 
 il numero di porta, che è 
\emph on 
2000
\emph default 
 se hai seguito le nostre impostazioni.
 
\series bold 
Deseleziona
\series default 
 
\emph on 
Il server necessita di una connessione protetta (SSL)
\emph default 
.
\layout Standard


\begin_inset Graphics
	filename advanced.ps
	lyxscale 50
	scale 80
	keepAspectRatio

\end_inset 


\layout Subsection

Tutorial per Proxy
\layout Standard

FreePOPs è in grado di utilizzare proxy HTTP.
 Se non sapete cosa siano oppure se nella vostra rete locale non ce n'è
 uno allora potete saltare questa sezione in quanto le operazioni qui descrite
 saranno per voi superflue.
\layout Standard

Per utilizzare un proxy HTTP, FreePOPs supporta l'opzione 
\family typewriter 
-P
\family default 
, o l'equivalente opzione lunga 
\family typewriter 
--proxy
\family default 
, per specificare indirizzo e porta del proxy separati da : (due punti),
 ad esempio 
\family typewriter 
-P proxy.localnet.org:8080
\family default 
 oppure 
\family typewriter 
-P 192.168.1.1
\family default 
 sono esempi validi.
 Se non è specificato alcun numero di porta allora sarà utilizzato 
\family typewriter 
8080
\family default 
 come valore di default.
\layout Standard

Se per utilizzare il proxy è necessaria un'autenticazione, usate anche l'opzione
 
\family typewriter 
-A nomeutente:password
\family default 
.
\layout Standard

Ricordatevi che i valori specificati con l'opzione -P hanno la precedenza
 su qualsiasi altro valore ottenuto dal sistema operativo utilizzato.
\layout Standard

In ambienti POSIX è possibile impostare l'utilizzo di un proxy anche attraverso
 opportune variabili d'ambiente.
\layout Standard

Le variabili d'ambiente che saranno utilizzate sono, in ordine di precedenza,
 
\family typewriter 
HTTP_PROXY
\family default 
, 
\family typewriter 
http_proxy
\family default 
, 
\family typewriter 
PROXY
\family default 
 e 
\family typewriter 
proxy
\family default 
.
 
\layout Subsection

Spam/AV tutorial
\layout Standard

Molti utenti, soprattutto della versione per Windows, utilizzano svariati
 antivirus e software antispam che necessitano un minimo di configurazione.
 Grazie alla collaborazione sul forum di LiberoPOPs tra gli sviluppatori
 e gli utenti è stato realizzato questo tutorial che è valido anche per
 FreePOPs.
\layout Subsubsection

Norton AntiVirus, versione 2002 e successive
\layout Standard

È necessario mettere FreePOPs in ascolto sulla porta 110 per mezzo dell'opzione
 
\family typewriter 
-p
\family default 
 e successivamente impostare il proprio client email perché riceva la posta
 sulla porta 110.
 Per cambiare le opzioni di FreePOPs, consultare le FAQ alla domanda "Come
 cambio i parametri della riga di comando di FreePOPs?" 
\layout Subsubsection

Avast! Antivirus
\layout Standard

Nel proprio client email, modificare il nome utente in questo modo: 
\newline 

\family typewriter 
indirizzo@email#localhost:2000
\family default 
 Sempre all'interno delle opzioni del proprio client email, impostare il
 numero di porta del server POP3 a 110, invece che a 2000 come descritto
 nei precedenti tutorial.
 
\layout Subsubsection

AVG Pro 7 Antivirus
\layout Standard

Nel proprio client email, modificare il numero di porta POP3 a 5300, lasciare
 inalterati nome utente e server (
\family typewriter 
email@address
\family default 
 e 
\family typewriter 
localhost
\family default 
).
 In AVG, entrare in "Proprietà > Servers > Creare un Server di posta POP3
 (server type)", in connection impostare Fixed host: 127.0.0.1:2000 e Local
 port: 5300 
\layout Subsubsection

SpamHilator
\layout Standard

Configurare il proprio client email con i seguenti parametri: Server POP3
 (posta in entrata): localhost Porta server POP3: 110 Nome Utente: 
\newline 

\family typewriter 
localhost&indirizzo@email&2000 
\layout Subsubsection

Mailshield Desktop
\layout Standard

In Mailshield Desktop, scegliere "Edit mail account", relativamente alla
 propria casella.
 In "Account name" ed in "Email address" inserire il proprio indirizzo email
 completo.
 Scegliere poi "Access", in "type of Email server" utilizzare "POP3 mail
 account", mentre in "incoming mail server" immettere 127.0.0.1.
 Può inoltre essere utile selezionare l'opzione "Use relaxed timeouts whit
 this email server".
 
\layout Subsubsection

K9
\layout Standard

Configurare il proprio client email inserendo 9999 come porta del server
 POP3.
 Lasciare localhost come nome del server.
 Inserire poi come nome utente 
\family typewriter 
localhost/2000/indirizzo@email 
\layout Subsubsection

SpamTerminator
\layout Standard

Configurare il proprio client email con i seguenti parametri: Server POP3
 (posta in entrata): 
\family typewriter 
localhost
\family default 
 Porta server POP3: 8110 Nome Utente: 
\newline 

\family typewriter 
indirizzo@email#localhost
\family default 
 Avviare poi FreePOPs con l'opzione -p 110.
 
\layout Subsubsection

SpamPal
\layout Standard

Configurare il proprio client email con i seguenti parametri: Server POP3
 (posta in entrata): 
\family typewriter 
localhost
\family default 
 Porta server POP3: 110 Nome Utente: 
\newline 

\family typewriter 
indirizzo@email@localhost:2000
\layout Subsection

LAN tutorial 
\layout Subsubsection*

Come utilizzare FreePOPs come server in una rete di calcolatori (tutorial
 orientato a Windows).
\layout Standard

La LAN è composta da due macchine (o più, ma da 2 a 100 è uguale).
 Le macchine le chiameremo 
\emph on 
Sola
\emph default 
 (il server) e 
\emph on 
Cucco
\emph default 
 (il client).
 FreePOPs parte su 
\emph on 
Sola
\emph default 
 e lo lancio così: 
\newline 

\family typewriter 
freepopsd.exe -b 0.0.0.0 -p 110
\family default 
 
\family typewriter 

\newline 

\family default 
che significa che il servizio offerto da FreePOPs sarà offerto a tutti,
 cioè FreePOPs si mette in ascolto su tutte le interfacce di rete.
 E lo metto in ascolto alla porta standard per il POP3 (la 110).
 Non è necessario, 2000 va bene, ma visto che è un server lo facciamo partire
 sulla porta standard.
 Ora configuro il client di posta su Cucco.
 Come server POP3 di posta scelgo 
\emph on 
Sola
\emph default 
 e la porta nel caso la metto a 
\emph on 
110
\emph default 
.
 Mettiamo che anche 
\emph on 
Sola
\emph default 
 (anche se è un server) abbia un monitor e che ci voglia leggere la posta.
 Qui il client di posta lo configuro a 
\emph on 
localhost
\emph default 
 e 
\emph on 
110
\emph default 
.
\layout Standard

Fondamentale per la lan è il 
\family typewriter 
-b 0.0.0.0
\family default 
 in quanto di default su Windows FreePOPs parte con 
\family typewriter 
-b 127.0.0.1
\family default 
 in modo che non offra un servizio alla eventuale rete ma solo al pc stesso.
\layout Section

Plugin
\layout Standard

Qui diamo una descrizione dettagliata di ogni plugin, ma prima di iniziare
 spieghiamo la maniera generale di passare argomenti speciali ai plugin
 (leggete la descrizione specifica di un plugin per sapere quali argomenti
 esso accetta).
\layout Subsection

Parameters
\layout Standard

Ogni plugin può ricevere parametri passati come aggiunta allo username.
 Lo username seguente è per il plugin
\family typewriter 
 popforward.lua
\family default 
:
\newline 

\family typewriter 
gareuselesinge@mydomain.xx?host=pop.mydomain.xx&port=110
\family default 

\newline 
Dato che potreste usare qualche proxy antispam o altri programmi che possono
 maneggiare il vostro username e potrebbero non gradire il carattere 
\family typewriter 
?
\family default 
 potete usare uno spazio al suo posto.
 Ogni altro carattere che segue 
\family typewriter 
?
\family default 
 può essere preceduto per convenienza da 
\family typewriter 
%XXX
\family default 
 dove 
\family typewriter 
XXX
\family default 
 sono i numeri riportati nell'Appendice.
\layout Standard

Un altro modo di fare hacking dello username è con i binding dominio-plugin
 fatti al volo.
 Potreste trovare utile dire: 
\begin_inset Quotes eld
\end_inset 

Voglio usare il plugin X per il dominio Y senza cambiare il file config.lua
\begin_inset Quotes erd
\end_inset 

.
 In questo caso dovrete usare il nome del plugin (per esempio popforward.lua)
 come nome di dominio e probabilmente dovrete passargli alcuni argomenti
 usando la procedura descritta prima.
 Questo è un esempio:
\newline 

\family typewriter 
gareuselesinge@popforward.lua?host=pop.mymailsite.xx&port=110
\family default 

\newline 
Ricordate che in caso di uso di binding 
\begin_inset Quotes eld
\end_inset 

al volo
\begin_inset Quotes erd
\end_inset 

 non ci saranno argomenti di default, quindi 
\family typewriter 
port=110
\family default 
 non può essere omesso, come nell'esempio precedente.
\layout Subsection

libero.lua
\layout Standard

Questo plugin vi permette di leggere le mail che avete in una mailbox 
\family typewriter 
@libero.it
\family default 
, 
\family typewriter 
@iol.it
\family default 
, 
\family typewriter 
@inwind.it
\family default 
 e 
\family typewriter 
@blu.it
\family default 
.
 ciò significa che potete ancora usare il vostro mail reader preferito invece
 di usare la webmail.
 Questo plugin agisce come un browser che sfoglia il vostro account webmail
 e lo fa apparire come un server POP3.
 Per maggiori informazioni su questo plugin potete guardare il sito web
 di LiberoPOPs (antenato di FreePOPs) su 
\family typewriter 
http://liberopops.sourceforge.net
\layout Standard

Per usare questo plugin dovete usare il vostro indirizzo email completo
 come username e la vostra password reale come password.
 Questo plugin accetta i seguenti parametri:
\layout Description

folder serve per selezionare la cartella (
\family typewriter 
inbox
\family default 
 è quella di default) su cui operare.
 Le cartelle standard disponibili sono 
\family typewriter 
draft
\family default 
, 
\family typewriter 
inbox
\family default 
, 
\family typewriter 
outbox
\family default 
, 
\family typewriter 
trash
\family default 
.
 Se hai creato delle cartelle dalla webmail allora puoi accedervi usando
 il loro nome.
 Se la cartella non è al livello principale puoi accederci usando una 
\family typewriter 
/
\family default 
 per separala dalla cartella padre.
 Questo e' un esempio di uno username per leggere la cartella 
\family typewriter 
son
\family default 
, che è una sottocartella della cartella 
\family typewriter 
father
\family default 
:
\newline 

\family typewriter 
foo@libero.it?folder=father/son
\layout Subsection

tin.lua 
\layout Standard

Questo plugin vi permette di leggere le mail che avete in una mailbox 
\family typewriter 
@virgilio.it
\family default 
, 
\family typewriter 
@tin.it
\family default 
.
 Per usare questo plugin dovete usare il vostro indirizzo email completo
 come username e la vostra password reale come password.
 Visto che potresti aver bisogno di scaricare altre cartelle oltre alle
 
\family typewriter 
INBOX
\family default 
 (che è quella di default) il plugin accetta il parametro 
\family typewriter 
folder
\family default 
 e l'unico valore attualmente testato è 
\family typewriter 
Spam
\family default 
, ma anche altre cartelle dovrebbero funzionare.
 Ecco un esempio di username per controllare la cartella 
\family typewriter 
Spam
\family default 
:
\newline 

\family typewriter 
foo@virgilio.it?folder=Spam 
\layout Subsection

lycos.lua
\layout Standard

Questo plugin vi permette di leggere le mail che avete in una mailbox 
\family typewriter 
@lycos.it
\family default 
.
 Per usare questo plugin dovete usare il vostro indirizzo email completo
 come username e la vostra password reale come password.
\layout Subsection

popforward.lua
\layout Standard

Questo plugin è stato sviluppato per testare FreePOPs prima che fossero
 scritti altri veri plugin.
 Esso semplicemente inoltra richieste locali verso un vero server POP3.
 può essere usato per mascherare un server POP3 che ha dei bug, ma se pensate
 di averne bisogno dovreste esaminare attentamente il codice del plugin
 e aggiungere controlli per migliorare il rilevamento/la prevenzione di
 richieste malevole, dato che il plugin stesso non è nato con in mente la
 sicurezza.
 
\layout Standard

Per usare questo plugin dovete modificare il file config.lua.
 Questo perché non possiamo aggiungere tutti i server POP3 esistenti al
 file :) Il plugin richiede due argomenti, l'host POP3 e la porta (di solito
 
\family typewriter 
110
\family default 
) su cui il server è in ascolto.
 Questo è un esempio di una riga di configurazione per questo plugin, in
 cui ogni indirizzo email del dominio 
\family typewriter 
@virgilio.it
\family default 
 sono inoltrati a 
\family typewriter 
in.virgilio.it:110
\family default 
:
\begin_inset ERT
status Collapsed

\layout Standard

\backslash 
linespread{0.5}
\layout Standard

\backslash 
begin{footnotesize}
\layout Standard

\backslash 
begin{verbatim}
\layout Standard
-- popforward plugin 
\layout Standard
freepops.MODULES_MAP["virgilio.it"]     = {         
\layout Standard
       name="popforward.lua",         
\layout Standard
       args={ 
\layout Standard
              port=110,
\layout Standard
              host="in.virgilio.it"
\layout Standard
       } 
\layout Standard
} 
\layout Standard

\backslash 
end{verbatim}
\layout Standard

\backslash 
end{footnotesize}
\end_inset 

Potete ottenere gli stessi risultati usando il metodo di passaggio degli
 argomenti descritto nel primo paragrafo di questo capitolo.
 Questi sono gli argomenti accettati:
\layout Description

host Il server pop3 a cui vi volete collegare
\layout Description

port La porta del server pop3, di solito 110
\layout Description

realusername Se fate bind di questo plugin al volo probabilmente dovrete
 specificare il vero username qui, visto che lo username specificato contiene
 il nome del plugin e sarà quindi non valido.
\layout Subsection

aggregator.lua
\layout Standard

Solitamente potete trarre beneficio dal formato RSS del W3C quando leggete
 news da qualche sito web.
 Il file RSS indicizza le news, fornendo un link verso di esse.
 Questo plugin può far si' che il vostro client di posta veda il file RSS
 come una mailbox da cui potete scaricare ogni news come se fosse una mail.
 L'unica limitazione è che questo plugin può prelevare solo un sunto delle
 news più il link alle news.
 
\layout Standard

Per usare questo plugin dovete usare un nome utente casuale con il suffisso
 
\family typewriter 
@aggregator
\family default 
 (es.: 
\family typewriter 
foo@aggregator
\family default 
) e come password l'URL del file RSS (es.: 
\family typewriter 
http://www.securityfocus.com/rss/vulnerabilities.xml
\family default 
).
 Per comodita' abbiamo aggiunto per voi alcuni alias.
 Questo significa che non dovrete cercare a mano l'URL del file RSS.
 Abbiamo aggiunto alcuni domini, per esempio 
\family typewriter 
@securityfocus.com
\family default 
, che possono essere usati per sfruttare direttamente il plugin aggregator
 con questi siti web.
 Per usare questi alias dovrete usare un nome utente nella forma 
\family typewriter 
qualcosa@aggregatordomain
\family default 
 e una password a caso.
 Questa è la lista di alias per il plugin aggregator.
\newline 

\newline 

\begin_inset  Tabular
<lyxtabular version="3" rows="14" columns="2">
<features>
<column alignment="left" valignment="top" leftline="true" width="0">
<column alignment="left" valignment="top" leftline="true" rightline="true" width="0">
<row topline="true" bottomline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\layout Standard


\family typewriter 
\size footnotesize 
aggregatordomain
\end_inset 
</cell>
<cell alignment="left" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\layout Standard


\size footnotesize 
descrizione
\end_inset 
</cell>
</row>
<row topline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\layout Standard


\family typewriter 
\size footnotesize 
freepops.rss.en
\end_inset 
</cell>
<cell multicolumn="1" alignment="left" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\layout Standard


\family typewriter 
\size footnotesize 
http://freepops.sourceforge.net/
\family default 
 news (Inglese)
\end_inset 
</cell>
</row>
<row topline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\layout Standard


\family typewriter 
\size footnotesize 
freepops.rss.it
\end_inset 
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\layout Standard


\family typewriter 
\size footnotesize 
http://freepops.sourceforge.net/
\family default 
 news (Italiano)
\end_inset 
</cell>
</row>
<row topline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\layout Standard


\family typewriter 
\size footnotesize 
flatnuke.sf.net
\end_inset 
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\layout Standard


\family typewriter 
\size footnotesize 
http://flatnuke.sourceforge.net/
\family default 
 news (Italiano)
\end_inset 
</cell>
</row>
<row topline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\layout Standard


\family typewriter 
\size footnotesize 
ziobudda.net
\end_inset 
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\layout Standard


\family typewriter 
\size footnotesize 
http://ziobudda.net/
\family default 
 news (sia Italiano che Inglese)
\end_inset 
</cell>
</row>
<row topline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\layout Standard


\family typewriter 
\size footnotesize 
punto-informatico.it
\end_inset 
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\layout Standard


\family typewriter 
\size footnotesize 
http://punto-informatico.it/
\family default 
 news (Italiano)
\end_inset 
</cell>
</row>
<row topline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\layout Standard


\family typewriter 
\size footnotesize 
gaim.sf.net
\end_inset 
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\layout Standard


\family typewriter 
\size footnotesize 
http://gaim.sourceforge.net/
\family default 
 news (Inglese)
\end_inset 
</cell>
</row>
<row topline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\layout Standard


\family typewriter 
\size footnotesize 
linuxdevices.com
\end_inset 
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\layout Standard


\family typewriter 
\size footnotesize 
http://linuxdevices.com/
\family default 
 news (Inglese)
\end_inset 
</cell>
</row>
<row topline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\layout Standard


\family typewriter 
\size footnotesize 
securityfocus.com
\end_inset 
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\layout Standard


\family typewriter 
\size footnotesize 
http://www.securityfocus.com/ 
\family default 
new vulnerabilities (Inglese)
\end_inset 
</cell>
</row>
<row topline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\layout Standard


\family typewriter 
\size footnotesize 
games.gamespot.com
\end_inset 
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\layout Standard


\family typewriter 
\size footnotesize 
http://www.gamespot.com/ 
\family default 
computer games news (Inglese)
\end_inset 
</cell>
</row>
<row topline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\layout Standard


\family typewriter 
\size footnotesize 
news.gamespot.com
\end_inset 
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\layout Standard


\family typewriter 
\size footnotesize 
http://www.gamespot.com/ 
\family default 
GameSpot news (Inglese)
\end_inset 
</cell>
</row>
<row topline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\layout Standard


\family typewriter 
\size footnotesize 
kerneltrap.org
\end_inset 
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\layout Standard


\family typewriter 
\size footnotesize 
http://kerneltrap.org 
\family default 
news (Inglese)
\end_inset 
</cell>
</row>
<row topline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\layout Standard


\family typewriter 
\size footnotesize 
mozillaitalia.org
\end_inset 
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\layout Standard


\family typewriter 
\size footnotesize 
http://www.mozillaitalia.org 
\family default 
news (Italiano)
\end_inset 
</cell>
</row>
<row topline="true" bottomline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\layout Standard


\family typewriter 
\size footnotesize 
linux.kerneltrap.org
\end_inset 
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\layout Standard


\family typewriter 
\size footnotesize 
http://linux.kerneltrap.org 
\family default 
news (Inglese)
\end_inset 
</cell>
</row>
</lyxtabular>

\end_inset 


\layout Subsection

flatnuke.lua
\layout Standard

Questo plugin è un plugin aggregator specializzato nei siti web fatti con
 il CMS FlatNuke
\begin_inset Foot
collapsed true

\layout Standard

HTTP://flatnuke.sourceforge.net
\end_inset 

 , o altri siti che usano lo stesso formato delle news come il sito di FreePOPs.
 Dato che in un sito FlatNuke le news sono memorizzate in semplici file
 xml questo plugin è in grado di prelevare tutte le news, non solo le intestazio
ni come il plugin aggregator.
 ciò è molto utile se non vuoi sfogliare l'intero sito web per leggere le
 news.
\layout Standard

Per usare questo plugin dovete avere un nome utente con il dominio 
\family typewriter 
@flatnuke
\family default 
 (es.: 
\family typewriter 
qualcosa@flatnuke
\family default 
) e l'URL di una homepage flatnuke come password (es.: 
\family typewriter 
http://flatnuke.sourceforge.net/
\family default 
, non c'è bisogno di URL di file RSS visto che FlatNuke mette gli RSS in
 una posizione nota e fissata.
 Ci sono alcuni alias per siti FlatNuke, vedi la documentazione del plugin
 aggregator per sapere cosa significa):
\newline 

\newline 

\begin_inset  Tabular
<lyxtabular version="3" rows="4" columns="2">
<features>
<column alignment="left" valignment="top" leftline="true" width="0">
<column alignment="left" valignment="top" leftline="true" rightline="true" width="0">
<row topline="true" bottomline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\layout Standard


\family typewriter 
\size footnotesize 
aggregatordomain
\end_inset 
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\layout Standard


\size footnotesize 
descrizione
\end_inset 
</cell>
</row>
<row topline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\layout Standard


\family typewriter 
\size footnotesize 
freepops.en
\end_inset 
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\layout Standard


\family typewriter 
\size footnotesize 
http://freepops.sourceforge.net/
\family default 
 full news (Inglese)
\end_inset 
</cell>
</row>
<row topline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\layout Standard


\family typewriter 
\size footnotesize 
freepops.it
\end_inset 
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\layout Standard


\family typewriter 
\size footnotesize 
http://freepops.sourceforge.net/
\family default 
 full news (Italiano)
\end_inset 
</cell>
</row>
<row topline="true" bottomline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\layout Standard


\family typewriter 
\size footnotesize 
flatnuke.it
\end_inset 
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\layout Standard


\family typewriter 
\size footnotesize 
http://flatnuke.sourceforge.net/
\family default 
 full news (Italiano)
\end_inset 
</cell>
</row>
</lyxtabular>

\end_inset 


\layout Subsection

kernel.lua
\layout Standard

Questo è un plugin specializzato per tenersi aggiornati sulle ultime versioni
 del kernel Linux.
 La pagina ufficiale che pubblica la lista delle versioni correnti del kernel
 Linux è 
\family typewriter 
http://kernel.org
\family default 
.
 Esiste un metodo comune, per i progetti sviluppati in sistemi GNU, per
 aggiornare l'utente sulle modifiche effettuate nelle nuove versioni di
 un programma.
 In ogni pacchetto è infatti presente il file 
\family typewriter 
ChangeLog
\family default 
 che descrive le novita' apportate dagli autori.
 Anche il kernel Linux ha un 
\family typewriter 
ChangeLog
\family default 
 per ogni versione nuova.
 Se desideri essere aggiornato sulle novita' apportate nelle versioni del
 kernel e, quindi, visionare il 
\family typewriter 
ChangeLog
\family default 
, puoi utilizzare questo plugin.
 sarà sufficiente inserire come nome utente 
\family typewriter 
qualcosa@kernel.org
\family default 
 per essere aggiornato, tramite 
\family typewriter 
ChangeLog
\family default 
, su ogni nuova versione, oppure 
\family typewriter 
qualcosa@kernel.org.24
\family default 
 o 
\family typewriter 
qualcosa@kernel.org.26
\family default 
 per visualizzare nella propria mailbox, rispettivamente, i 
\family typewriter 
ChangeLog
\family default 
 dell'ultima versione del ramo 2.4 e del 2.6.
 Come password è possibile inserire una qualsiasi stringa casuale.
 
\layout Subsection

gmail.lua
\layout Standard

Questo plugin vi permette di leggere le mail che avete in una mailbox 
\family typewriter 
@gmail.com
\family default 
.
 Per usare questo plugin dovete usare il vostro indirizzo email completo
 come username e la vostra password reale come password.
 E' anche possibile esportare la rubrica usando come username 
\family typewriter 
username#export@gmail.com
\family default 
.
 Un file 
\family typewriter 
gmail_contacts_export.csv
\family default 
 che può essere importato nel tuo mail client preferito verrà generato nella
 tua home (Unix) o nella directory Documenti (Windows).
 Per usare questo plugin hai bisogno della versione di FreePOPs con SSL
 (per Windows scarica FreePOPs-X.Y.Z-SSL.exe, per Unix probabilmente devi installar
e openssl).
\layout Section

Creare un plugin
\layout Standard

Seguono due sezioni, la prima è una panoramica veloce su cosa un plugin
 deve fare, la seconda è un tutorial più dettagliato.
 Prima di procedere oltre suggeriamo di leggere un po' di documentazione
 alla  base della scrittura dei plugin:
\layout Enumerate

Dato che i plugin sono scritti in LUA dovete leggere almeno il tutorial
 LUA (HTTP://lua-users.org/wiki/LuaTutorial); molte grazie a chi l'ha scritto.
 LUA è un linguaggio di scripting piuttosto semplice, facile da imparare,
  e facile da leggere.
 Se siete interessati a questo linguaggio dovreste leggere IL libro su LUA
 (
\begin_inset Quotes eld
\end_inset 

Programming in LUA
\begin_inset Quotes erd
\end_inset 

 di Roberto Ierusalimschy HTTP://www.inf.puc-rio.br/~roberto/book/).
 è davvero un buon libro, credetemi.
 Oggi il libro è stato pubblicato on line http://www.lua.org/pil/
\layout Enumerate

Visto che dobbiamo implementare un backend POP3 dovreste sapere cos'è il
 POP3.
 La RFC 1939 è inclusa nella directory doc/ del pacchetto dei sorgenti di
 FreePOPs, ma potete prelevarla anche dalla rete HTTP://www.ietf.org/rfc/rfc1939.tx
t.
\layout Enumerate

Leggete attentamente questo tutorial, è lontano dall'essere ben fatto ma
 è meglio di niente.
\layout Enumerate

Il sito web contiene, nella sezione doc, un bel po' di documentazione sui
 sorgenti.
 Dovreste tenere un web browser aperto alla pagina della documentazione
 sui moduli LUA mentre scrivete un plugin.
\layout Enumerate

Dopo aver creato un prototipo, dovreste leggere un plugin completo.
 Il plugin libero.lua è davvero ben commentato, iniziate pure da li'.
\layout Enumerate

Ricordate che questo software ha un forum ufficiale (HTTP://freepops.diludovico.it
) e degli autori a cui potete chiedere aiuto.
\layout Enumerate

FreePOPs è distribuito sotto licenza GNU/GPL.
 Questo significa che ogni software che fa uso del codice di FreePOPs deve
 essere rilasciato sotto la stessa licenza.
 Questo include i plugin.
 Per maggiori informazioni leggete il testo della licenza nel file 
\family typewriter 
COPYING
\family default 
 incluso o su HTTP://www.gnu.org/licenses/gpl.html.
\layout Subsection

Panoramica sui plugin
\layout Standard

Un plugin è essenzialmente un backend per un server POP3.
 I plugin sono scritti in LUA
\begin_inset Foot
collapsed true

\layout Standard

Il sito web del linguaggio è HTTP://www.lua.org
\end_inset 

 mentre il server POP3 è scritto in C.
 Qui esamineremo l'interfaccia tra il nucleo C e i plugin LUA.
\layout Subsection

L'interfaccia tra il nucleo C ed un plugin
\layout Standard

Come abbiamo spiegato prima il frontend POP3 in C deve essere collegato
 ad un backend in LUA.
 L'interfaccia è molto semplice se conoscete il protocollo POP3.
 Qui riassumiamo brevemente il significato, ma la RFC 1939 (inclusa nella
  directory 
\family typewriter 
doc/
\family default 
 della distribuzione dei sorgenti) è molto breve e facile da leggere.
 Come il vostro intuito dovrebbe suggerirvi il client POP3 può richiedere
 che il server POP3 conosca qualcosa delle mail che sono nella mailbox e
 prima o poi prelevare/cancellare dei messaggi.
 E questo è esattamente ciò che fa.
\layout Standard

Il backend deve implementare tutti i comandi POP3 (come USER, PASS, RETR,
 DELE, QUIT, LIST, ...) e deve restituire al frontend il risultato.
 Diamo un semplice esempio di una sessione POP3 dalla RFC:
\layout Standard


\begin_inset ERT
status Collapsed

\layout Standard

\backslash 
linespread{0.5}
\layout Standard

\backslash 
begin{footnotesize}
\layout Standard

\backslash 
begin{verbatim}
\layout Standard
     1  S: <wait for connection on TCP port 110>
\layout Standard
     2  C: <open connection>
\layout Standard
     3  S:    +OK POP3 server 
\layout Standard
     4  C:    USER linux@kernel.org
\layout Standard
     5  S:    +OK now insert the pasword
\layout Standard
     6  C:    PASS gpl
\layout Standard
     7  S:    +OK linux's maildrop has 2 messages (320 octets)
\layout Standard
     8  C:    STAT
\layout Standard
     9  S:    +OK 1 320
\layout Standard
    10  C:    LIST
\layout Standard
    11  S:    +OK 2 messages (320 octets)
\layout Standard
    12  S:    1 320
\layout Standard
    13  S:    .
\layout Standard
    14  C:    RETR 1
\layout Standard
    15  S:    +OK 120 octets
\layout Standard
    16  S:    <the POP3 server sends message 1>
\layout Standard
    17  S:    .
\layout Standard
    18  C:    DELE 1
\layout Standard
    19  S:    +OK message 1 deleted
\layout Standard
    20  C:    QUIT
\layout Standard
    21  S:    +OK dewey POP3 server signing off (maildrop empty)
\layout Standard
    22  C:  <close connection>
\layout Standard
    23  S:  <wait for next connection>
\layout Standard

\backslash 
end{verbatim}
\layout Standard

\backslash 
end{footnotesize}
\end_inset 


\layout Standard

In questa sessione il backend verrà chiamato per le righe 4, 6, 8, 10, 14,
 18, 20 (tutte le righe 
\family typewriter 
C:
\family default 
 ) e rispettivamente le funzioni che implementano i comandi POP3 verranno
 chiamate in questo modo
\layout Standard


\begin_inset ERT
status Collapsed

\layout Standard

\backslash 
linespread{0.5}
\layout Standard

\backslash 
begin{footnotesize}
\layout Standard

\backslash 
begin{verbatim}
\layout Standard
    user(p,"linux@kernel.org")
\layout Standard
    pass(p,"gpl")
\layout Standard
    stat(p)
\layout Standard
    list_all(p)
\layout Standard
    retr(p,1)
\layout Standard
    dele(p,1)
\layout Standard
    quit_update(p)
\layout Standard

\backslash 
end{verbatim}
\layout Standard

\backslash 
end{footnotesize}
\end_inset 


\layout Standard

più tardi chiariremo cos'è p.
 Speriamo di toglierlo e renderlo implicito per completa trasparenza.
 è facile capire che c'è un mapping 1-1 tra i comandi POP3 e le chiamate
 a funzione del plugin.
 Potete vedere un plugin come l'implementazione dell'interfaccia POP3.
\layout Subsection

L'interfaccia tra un plugin e il nucleo C
\layout Standard

Prendiamo in esame la chiamata a 
\family typewriter 
pass(p,
\begin_inset Quotes erd
\end_inset 

linux@kernel.org
\begin_inset Quotes erd
\end_inset 

)
\family default 
.
 Qui il plugin dovrebbe autenticare l'utente (se c'è un qualche tipo di
 autenticazione) e informare il nucleo C del risultato.
 Per ottenere questo ogni funzione dei plugin deve restituire un flag di
 errore, per essere più precisi uno di questi errori:
\newline 

\layout Standard


\begin_inset  Tabular
<lyxtabular version="3" rows="10" columns="2">
<features>
<column alignment="left" valignment="top" leftline="true" width="0">
<column alignment="block" valignment="top" leftline="true" rightline="true" width="7cm">
<row topline="true" bottomline="true">
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\layout Standard


\size footnotesize 
Code
\end_inset 
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none" width="7cm">
\begin_inset Text

\layout Standard


\size footnotesize 
Significato
\end_inset 
</cell>
</row>
<row topline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\layout Standard


\family typewriter 
\size footnotesize 
POPSERVER_ERR_OK
\end_inset 
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\layout Standard


\size footnotesize 
Nessun errore
\end_inset 
</cell>
</row>
<row topline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\layout Standard


\family typewriter 
\size footnotesize 
POPSERVER_ERR_NETWORK
\end_inset 
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\layout Standard


\size footnotesize 
Errore di rete
\end_inset 
</cell>
</row>
<row topline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\layout Standard


\family typewriter 
\size footnotesize 
POPSERVER_ERR_AUTH
\end_inset 
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\layout Standard


\size footnotesize 
Autenticazione fallita
\end_inset 
</cell>
</row>
<row topline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\layout Standard


\family typewriter 
\size footnotesize 
POPSERVER_ERR_INTERNAL
\end_inset 
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\layout Standard


\size footnotesize 
Errore interno, segnalate il bug
\end_inset 
</cell>
</row>
<row topline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\layout Standard


\family typewriter 
\size footnotesize 
POPSERVER_ERR_NOMSG
\end_inset 
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\layout Standard


\size footnotesize 
Il numero del messaggio è fuori range
\end_inset 
</cell>
</row>
<row topline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\layout Standard


\family typewriter 
\size footnotesize 
POPSERVER_ERR_LOCKED
\end_inset 
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\layout Standard


\size footnotesize 
Mailbox bloccata da altre sessioni
\end_inset 
</cell>
</row>
<row topline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\layout Standard


\family typewriter 
\size footnotesize 
POPSERVER_ERR_EOF
\end_inset 
</cell>
<cell multicolumn="1" alignment="left" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\layout Standard


\size footnotesize 
Fine trasmissione, usata nel popserver_callback
\end_inset 
</cell>
</row>
<row topline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\layout Standard


\family typewriter 
\size footnotesize 
POPSERVER_ERR_TOOFAST
\end_inset 
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\layout Standard


\size footnotesize 
Non è possibile riconnettersi al server ora, attendere e riprovare
\end_inset 
</cell>
</row>
<row topline="true" bottomline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\layout Standard


\family typewriter 
\size footnotesize 
POPSERVER_ERR_UNKNOWN
\end_inset 
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\layout Standard


\size footnotesize 
Non ho idea di che errore ho trovato
\end_inset 
</cell>
</row>
</lyxtabular>

\end_inset 


\newline 

\newline 

\layout Standard

Nel nostro caso i codici d'errore più appropriati sono 
\family typewriter 
POPSERVER_ERR_AUTH
\family default 
 e 
\family typewriter 
POPSERVER_ERR_OK
\family default 
.
 Questo è un caso semplice, in cui un codice d'errore è abbastanza.
 Ora analizziamo il caso più complesso della chiamata a 
\family typewriter 
list_all(p)
\family default 
.
 Qui dobbiamo restituire un codice d'errore come prima, ma dobbiamo anche
 informare il nucleo C della grandezza di tutti i messaggi nella mailbox.
 Qui abbiamo bisogno del parametro p passato ad ogni funzione del plugin
 (notate che tale parametro potra' divenire implicito in futuro).
 
\family typewriter 
p
\family default 
 indica la struttura dati che il C si aspetta venga riempita chiamando funzioni
 appropriate come 
\family typewriter 
set_mailmessage_size(p,num,size)
\family default 
 dove num è il numero del messaggio e size è la grandezza in byte.
 Solitamente è molto comune mettere insieme più funzioni.
 Per esempio quando guardate la pagina di una webmail con la lista di messaggi
 conoscete il numero dei messaggi, la loro grandezza e lo UIDL così che
 potete riempire la struttura dati p con tutte le informazioni per LIST,
 STAT, UIDL.
 
\layout Standard

L'ultimo caso che esaminiamo è 
\family typewriter 
retr(p,num,data)
\family default 
.
 poiché un messaggio di posta può essere molto grande, non è un modo elegante
 di scaricare l'intero messaggio senza far sì che il client di posta si
 lamenti per la morte del server.
 La soluzione è usare un callback.
 Ogni volta che un plugin ha dei dati da mandare al client dovrebbe chiamare
 la 
\family typewriter 
popserver_callback(buffer,data)
\family default 
.
 
\family typewriter 
data
\family default 
 è una struttura opaca che il popserver necessita per compiere il suo lavoro
 (notate che questo parametro potrà venire rimosso per semplicità).
 In alcuni casi, per esempio se sapete che il messaggio è piccolo o state
 lavorando su una rete veloce, potete prelevare l'intero messaggio e mandarlo,
 ma ricordate che questo consuma più memoria.
\layout Subsection

L'arte di scrivere plugin (tutorial sui plugin)
\layout Standard

In questa sezione scriveremo un plugin passo passo, esaminando ogni dettaglio
 importante.
 Non scriveremo un vero e completo plugin poiché può diventare un pò difficile
 da seguire, ma creeremo una webmail ad-hoc per i nostri scopi.
\layout Subsubsection

(step 1) Lo scheletro
\layout Standard

La prima cosa che faremo sarà copiare il file 
\family typewriter 
skeleton.lua
\family default 
 in 
\family typewriter 
foo.lua
\family default 
 (perché scriveremo il plugin per la webmail 
\emph on 
foo.xx
\emph default 
 , 
\emph on 
xx
\emph default 
 sta per un dominio vero, ma non vogliamo menzionare alcun sito qui...).
 Ora con il vostro editor migliore (suggeriamo vim su Unix e scintilla per
 win32, visto che supportano il syntax highlighting per LUA, ma qualsiasi
 altro editor di testo va bene) aprite 
\family typewriter 
foo.lua
\family default 
 e cambiate le prime righe aggiungendo il nome del plugin, la versione,
 il vostro nome, il vostro indirizzo email e un breve commento, nei posti
 appropriati.
\begin_inset ERT
status Collapsed

\layout Standard

\backslash 
linespread{0.5}
\layout Standard

\backslash 
begin{footnotesize}
\layout Standard

\backslash 
begin{verbatim}
\layout Standard
-- ************************************************************************** --
\layout Standard
--  FreePOPs @--put domain here-- webmail interface
\layout Standard
--
\layout Standard
--  $Id$
\layout Standard
--
\layout Standard
--  Released under the GNU/GPL license
\layout Standard
--  Written by --put Name here-- <--put email here-->
\layout Standard
-- ************************************************************************** --
\layout Standard

\layout Standard
PLUGIN_VERSION = "--put version here--"
\layout Standard
PLUGIN_NAME = "--put name here--"
\layout Standard

\backslash 
end{verbatim}
\layout Standard

\backslash 
end{footnotesize}
\end_inset 

 Ora abbiamo un plugin vuoto, ma non è abbastanza per iniziare a farci hacking.
 Dobbiamo aprire il file 
\family typewriter 
config.lua
\family default 
 (nella distribuzione win32 si trova nella directory principale, mentre
 nella distribuzione Unix è in 
\family typewriter 
/etc/freepops/
\family default 
; altre copie di questo file possono essere incluse nelle distribuzioni,
 ma sono copie di backup) e aggiungete una riga come questa
\begin_inset ERT
status Collapsed

\layout Standard

\backslash 
linespread{0.5}
\layout Standard

\backslash 
begin{footnotesize}
\layout Standard

\backslash 
begin{verbatim}
\layout Standard
-- foo plugin
\layout Standard
freepops.MODULES_MAP["foo.xx"]      = {name="foo.lua"}
\layout Standard

\backslash 
end{verbatim}
\layout Standard

\backslash 
end{footnotesize}
\end_inset 

 all'inizio del file.
 Prima di finire il primo passo dovreste provare se il plugin viene correttament
e attivato da FreePOPs quando necessario.
 Per questo dovremo aggiungere alcune righe a 
\family typewriter 
foo.lua
\family default 
, in particolare dovremo aggiungere un valore di ritorno di errore a 
\family typewriter 
user()
\family default 
.
\begin_inset ERT
status Collapsed

\layout Standard

\backslash 
linespread{0.5}
\layout Standard

\backslash 
begin{footnotesize}
\layout Standard

\backslash 
begin{verbatim}
\layout Standard
-- -------------------------------------------------------------------------- --
\layout Standard
-- Must save the mailbox name
\layout Standard
function user(pstate,username)
\layout Standard
        return POPSERVER_ERR_AUTH
\layout Standard
end
\layout Standard

\backslash 
end{verbatim}
\layout Standard

\backslash 
end{footnotesize}
\end_inset 

 Ora la funzione user fallisce sempre, restituendo un errore di autenticazione.
 Dovrete ora lanciare FreePOPs (se è già in esecuzione non è necessario
 farlo ripartire) e lanciare telnet (sotto win32 dovreste aprire un prompt
 DOS, sotto Unix avrete una shell) e digitate 
\family typewriter 
telnet localhost 2000
\family default 
 e poi digitate 
\family typewriter 
user test@foo.xx
\family default 
.
\begin_inset ERT
status Collapsed

\layout Standard

\backslash 
linespread{0.5}
\layout Standard

\backslash 
begin{footnotesize}
\layout Standard

\backslash 
begin{verbatim}
\layout Standard
tassi@garfield:~$ telnet localhost 2000
\layout Standard
Trying 127.0.0.1...
\layout Standard
Connected to garfield.
\layout Standard
Escape character is '^]'.
\layout Standard
+OK FreePOPs/0.0.10 pop3 server ready
\layout Standard
user test@foo.xx
\layout Standard
-ERR AUTH FAILED
\layout Standard
Connection closed by foreign host.
\layout Standard

\backslash 
end{verbatim}
\layout Standard

\backslash 
end{footnotesize}
\end_inset 

 Il server risponde chiudendo la connessione e stampando un messaggio di
 autorizzazione fallita (va bene, dato che la funzione 
\family typewriter 
user()
\family default 
 del nostro plugin restituisce questo errore).
 Nel file standard error (la console sotto Unix, il file 
\family typewriter 
stderr.txt
\family default 
 sotto Windows) vengono stampati i messaggi d'errore, non vi prestate attenzione
 per ora.
\layout Subsubsection

(step 2) Il login
\layout Standard

La procedura di login è la prima cosa da fare.
 Il protocollo POP3 ha due comandi per il login, 
\emph on 
user
\emph default 
 e 
\emph on 
pass
\emph default 
.
 Prima il client esegue uno user, poi dice al server la password.
 Come abbiamo già visto nella panoramica questo significa che prima verrà
 eseguito 
\family typewriter 
user()
\family default 
 e poi
\family typewriter 
\emph on 
 
\emph default 
pass()
\family default 
.
 Questo è un esempio di login:
\begin_inset ERT
status Collapsed

\layout Standard

\backslash 
linespread{0.5}
\layout Standard

\backslash 
begin{footnotesize}
\layout Standard

\backslash 
begin{verbatim}
\layout Standard
tassi@garfield:~$ telnet localhost 2000
\layout Standard
Trying 127.0.0.1...
\layout Standard
Connected to garfield.
\layout Standard
Escape character is '^]'.
\layout Standard
+OK FreePOPs/0.0.10 pop3 server ready
\layout Standard
user test@foo.xx
\layout Standard
+OK PLEASE ENTER PASSWORD
\layout Standard
pass hello
\layout Standard
-ERR AUTH FAILED
\layout Standard

\backslash 
end{verbatim}
\layout Standard

\backslash 
end{footnotesize}
\end_inset 

 Se lanciate FreePOPs con il parametro 
\family typewriter 
-w
\family default 
 dovreste leggere questo sullo standard error/standard output:
\begin_inset ERT
status Collapsed

\layout Standard

\backslash 
linespread{0.5}
\layout Standard

\backslash 
begin{footnotesize}
\layout Standard

\backslash 
begin{verbatim}
\layout Standard
freepops started with loglevel 2 on a little endian machine.
\layout Standard
Cannot create pid file "/var/run/freepopsd.pid"
\layout Standard
DBG(popserver.c, 162): [5118] ?? Ip address 0.0.0.0 real port 2000
\layout Standard
DBG(popserver.c, 162): [5118] ?? Ip address 127.0.0.1 real port 2000
\layout Standard
DBG(popserver.c, 162): [5118] -> +OK FreePOPs/0.0.10 pop3 server ready
\layout Standard
DBG(popserver.c, 162): [5118] <- user test@foo.xx
\layout Standard
DBG(log_lua.c,  83): (@src/lua/foo.lua, 37) : FreePOPs plugin 'Foo web mail' version '0.0.1' started!
\layout Standard
*** the user wants to login as 'test@foo.xx'
\layout Standard
DBG(popserver.c, 162): [5118] -> +OK PLEASE ENTER PASSWORD
\layout Standard
DBG(popserver.c, 157): [5118] <- PASS *********
\layout Standard
*** the user inserted 'hello' as the password for 'test@foo.xx'
\layout Standard
DBG(popserver.c, 162): [5118] -> -ERR AUTH FAILED
\layout Standard
AUTH FAILED
\layout Standard
DBG(threads.c,  81): thread 0 will die
\layout Standard

\backslash 
end{verbatim}
\layout Standard

\backslash 
end{footnotesize}
\end_inset 

il plugin è stato modificato un pò per memorizzare i dati dell'utente e
 stampare delle informazioni di debug.
 Questo è il plugin che ha dato questo output:
\begin_inset ERT
status Collapsed

\layout Standard

\backslash 
linespread{0.5}
\layout Standard

\backslash 
begin{footnotesize}
\layout Standard

\backslash 
begin{verbatim}
\layout Standard
foo_globals= {
\layout Standard
username="nothing",
\layout Standard
password="nothing"
\layout Standard
}
\layout Standard
-- -------------------------------------------------------------------------- --
\layout Standard
-- Must save the mailbox name
\layout Standard
function user(pstate,username)
\layout Standard
foo_globals.username = username
\layout Standard
print("*** the user wants to login as '"..username.."'")
\layout Standard
return POPSERVER_ERR_OK
\layout Standard
end
\layout Standard
-- -------------------------------------------------------------------------- --
\layout Standard
-- Must login
\layout Standard
function pass(pstate,password)
\layout Standard
foo_globals.password = password
\layout Standard
print("*** the user inserted '"..password..
\layout Standard
    "' as the password for '"..foo_globals.username.."'")
\layout Standard
return POPSERVER_ERR_AUTH end
\layout Standard
-- -------------------------------------------------------------------------- --
\layout Standard
-- Must quit without updating
\layout Standard
function quit(pstate)
\layout Standard
return POPSERVER_ERR_OK
\layout Standard
end
\layout Standard

\backslash 
end{verbatim}
\layout Standard

\backslash 
end{footnotesize}
\end_inset 

Qui vediamo delle importanti novità.
 Per prima cosa, la tabella 
\family typewriter 
foo_globals
\family default 
 che contiene tutti i valori globali (valori che devono essere a disposizione
 di chiamate a funzioni successive) di cui abbiamo bisogno.
 Per ora ci abbiamo messo il nome utente e la password.
 La funzione
\family typewriter 
user()
\family default 
 ora memorizza il nome utente passato nella tabella 
\family typewriter 
foo_globals
\family default 
 e stampa qualcosa sullo standard output.
 La funzione 
\family typewriter 
pass()
\family default 
 allo stesso modo memorizza la password nella tabella globale e stampa qualcosa.
 La funzione 
\family typewriter 
quit()
\family default 
 restituisce semplicemente 
\family typewriter 
POPSERVER_ERR_OK
\family default 
 per far felice FreePOPs.
\layout Standard

Ora che sappiamo come FreePOPs si comporterà durante il login dobbiamo implement
are il login nella webmail, ma prima decommentiamo alcune righe nella funzione
 
\family typewriter 
init()
\family default 
 (chiamata alla partenza del plugin), la quale carica il modulo 
\family typewriter 
browser.lua
\family default 
 (il modulo usato per fare login nella webmail).
 Ecco la pagina di login della webmail vista con Mozilla e il codice sorgente
 della stessa pagina (con Mozilla lo si vede con Ctrl-U).
\layout Standard


\begin_inset Graphics
	filename login.eps
	lyxscale 50
	scale 80
	keepAspectRatio

\end_inset 


\layout Standard


\begin_inset ERT
status Collapsed

\layout Standard

\backslash 
begin{footnotesize}
\layout Standard

\backslash 
begin{verbatim}
\layout Standard
<html>
\layout Standard
<head>
\layout Standard
<title>foo.xx webmail login</title>
\layout Standard
</head>
\layout Standard
<body style="background-color : grey; color : white">
\layout Standard
<h1>Webmail login</h1>
\layout Standard
<form name="webmail" method="post" action="http://localhost:3000/">
\layout Standard
login: <input type="text" size="10" name="username"> <br>
\layout Standard
password: <input type="password" size="10" name="password"> <br>
\layout Standard
<input type="submit" value="login">
\layout Standard
</form>
\layout Standard
</body>
\layout Standard
</html>
\layout Standard

\backslash 
end{verbatim}
\layout Standard

\backslash 
end{footnotesize}
\end_inset 

Abbiamo due campi di input, uno chiamato username e uno chiamato password.
 Quando l'utente fa click su login il browser web eseguira' 
\family typewriter 
POST
\family default 
 sul 
\family typewriter 
HTTP://localhost:3000/
\family default 
 contenuto del form (ho usato un indirizzo locale per comodita', ma dovrebbe
 essere qualcosa come 
\family typewriter 
HTTP://webmail.foo.xx/login.php
\family default 
).
 Questo è ciò che il browser invia:
\begin_inset ERT
status Collapsed

\layout Standard

\backslash 
linespread{0.5}
\layout Standard

\backslash 
begin{footnotesize}
\layout Standard

\backslash 
begin{verbatim}
\layout Standard
POST / HTTP/1.1
\layout Standard
Host: localhost:3000
\layout Standard
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.6) Gecko/20040614 Firefox/0.8 Accept: */*
\layout Standard
Accept-Language: en-us,en;q=0.5
\layout Standard
Accept-Encoding: gzip,deflate
\layout Standard
Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7
\layout Standard
Keep-Alive: 300
\layout Standard
Connection: keep-alive
\layout Standard
Content-Type: application/x-www-form-urlencoded
\layout Standard
Content-Length: 37
\layout Standard

\layout Standard
username=test%40foo.xx&password=hello
\layout Standard

\backslash 
end{verbatim}
\layout Standard

\backslash 
end{footnotesize}
\end_inset 

 Non ci interessa la prima parte (l'header HTTP, visto che il modulo browser
 se ne occuperà), bensì l'ultima, i dati inviati.
 poiché i campi del form erano username e password, i dati inviati sono
\family typewriter 

\newline 
username=test%40.foo.xx&password=hello
\family default 
.
 Ora vogliamo riprodurre la stessa richiesta HTTP con il nostro plugin.
 Questo è il semplice codice che fara' proprio quello.
\begin_inset ERT
status Collapsed

\layout Standard

\backslash 
linespread{0.5}
\layout Standard

\backslash 
begin{footnotesize}
\layout Standard

\backslash 
begin{verbatim}
\layout Standard
-- -------------------------------------------------------------------------- --
\layout Standard
-- Must login
\layout Standard
function pass(pstate,password)
\layout Standard
foo_globals.password = password
\layout Standard

\layout Standard
print("*** the user inserted '"..password..
\layout Standard
     "' as the password for '"..foo_globals.username.."'")
\layout Standard

\layout Standard
-- create a new browser
\layout Standard
local b = browser.new()
\layout Standard

\layout Standard
-- store the browser object in globals
\layout Standard
foo_globals.browser = b
\layout Standard

\layout Standard
       -- create the data to post      
\layout Standard
       local post_data = string.format("username=%s&password=%s",
\layout Standard
               foo_globals.username,foo_globals.password)
\layout Standard
       -- the uri to post to   
\layout Standard
       local post_uri = "http://localhost:3000/"
\layout Standard

\layout Standard
       -- post it      
\layout Standard
       local file,err = nil, nil       
\layout Standard
  
\layout Standard
       file,err = b:post_uri(post_uri,post_data)
\layout Standard
       
\layout Standard
       print("we received this webpage: ".. file)      
\layout Standard
       return POPSERVER_ERR_AUTH 
\layout Standard
end 
\layout Standard

\backslash 
end{verbatim}
\layout Standard

\backslash 
end{footnotesize}
\end_inset 

 Prima creiamo un oggetto browser, poi mettiamo insieme 
\family typewriter 
post_uri
\family default 
 e 
\family typewriter 
post_data
\family default 
 usando un semplice 
\family typewriter 
string.format
\family default 
 (una funzione simile a printf).
 E questa è la richiesta risultante
\begin_inset ERT
status Collapsed

\layout Standard

\backslash 
linespread{0.5}
\layout Standard

\backslash 
begin{footnotesize}
\layout Standard

\backslash 
begin{verbatim}
\layout Standard
POST / HTTP/1.1 
\layout Standard
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.6) Gecko/20040322 Firefox/0.8
\layout Standard
Pragma: no-cache 
\layout Standard
Accept: */* 
\layout Standard
Host: localhost 
\layout Standard
Content-Length: 35 
\layout Standard
Content-Type: application/x-www-form-urlencoded
\layout Standard

\layout Standard
username=test@foo.xx&password=hello 
\layout Standard

\backslash 
end{verbatim}
\layout Standard

\backslash 
end{footnotesize}
\end_inset 

questo è essenzialmente come lo volevamo fare (dovremmo fare url-encode
 dei post data con 
\family typewriter 
curl.escape()
\family default 
).
 Abbiamo salvato l'oggetto browser sulla tabella globale, perché vogliamo
 usare lo stesso browser tutte le volte.
\layout Standard

Ora che abbiamo fatto login, vogliamo controllare la pagina risultante,
 e magari estrarre un ID di sessione che useremo poi.
 Questo è il codice per estrarre l'ID di sessione e la pagina HTML che abbiamo
 ricevuto in risposta alla richiesta di login
\begin_inset ERT
status Collapsed

\layout Standard

\backslash 
linespread{0.5}
\layout Standard

\backslash 
begin{footnotesize}
\layout Standard

\backslash 
begin{verbatim} 
\layout Standard
        ... come sopra qui ...
\layout Standard
     
\layout Standard
        print("we received this webpage: ".. file)
\layout Standard
        
\layout Standard
        -- search the session ID        
\layout Standard
        local _,_,id = string.find(file,"session_id=(%w+)")
\layout Standard

\layout Standard
        if id == nil then               
\layout Standard
               return POPSERVER_ERR_AUTH
\layout Standard
        end
\layout Standard

\layout Standard
        foo_globals.session_id = id
\layout Standard
        return POPSERVER_ERR_OK
\layout Standard
end 
\layout Standard

\backslash 
end{verbatim}
\layout Standard

\backslash 
end{footnotesize}
\end_inset 

 e questa è la pagina web restituita.
\newline 

\begin_inset Graphics
	filename logindone.eps
	lyxscale 50
	scale 80

\end_inset 


\begin_inset ERT
status Collapsed

\layout Standard

\backslash 
linespread{0.5}
\layout Standard

\backslash 
begin{footnotesize}
\layout Standard

\backslash 
begin{verbatim}
\layout Standard
<html> 
\layout Standard
<head> 
\layout Standard
<title>foo.xx webmail</title> 
\layout Standard
</head> 
\layout Standard
<body style="background-color : grey; color : white"> 
\layout Standard
<h1>Webmail - test@foo.xx</h1> 
\layout Standard
Login done! click here to view the inbox folder. 
\layout Standard
<a href="http://localhost:3000/inbox.php?session_id=ABCD1234">inbox</a> 
\layout Standard
</body> 
\layout Standard
</html>
\layout Standard

\backslash 
end{verbatim}
\layout Standard

\backslash 
end{footnotesize}
\end_inset 

 Notate che abbiamo estratto l'ID di sessione usando 
\newline 

\family typewriter 
string.find(file,
\begin_inset Quotes erd
\end_inset 

session_id=(%w+)
\begin_inset Quotes erd
\end_inset 

)
\family default 
.
 Questa è una funzione molto importante nella libreria LUA e, anche se è
 descritta nel tutorial LUA su HTTP://lua-users.org, parleremo un po' di
 capture anche qui.
 Guardiamo i sorgenti della pagina.
 Ci interessa la riga
\emph on 

\newline 

\family typewriter 
\emph default 
<a href="HTTP://localhost:3000/inbox.php?session_id=ABCD1234">inbox</a>
\family default 
 
\emph on 

\newline 

\emph default 
che contiene il session_id che vogliamo catturare.
 La nostra espressione è 
\family typewriter 
\emph on 
session_id=(%w+)
\family default 
\emph default 
 che significa che vogliamo trovare tutte le stringhe che iniziano con 
\family typewriter 
session_id=
\family default 
 e poi continuano con uno o più caratteri alfanumerici.
 Siccome abbiamo scritto 
\family typewriter 
%w+
\family default 
 tra parentesi tonde, intendiamo catturare il contenuto delle parentesi
 (la parte alfanumerica).
 Così string.find restituirà tre valori, i primi due sono ignorati (assegnati
 alla variabile dummy 
\family typewriter 
_
\family default 
) mentre il terzo è la stringa catturata (nel nostro caso 
\family typewriter 
ABCD1234
\family default 
).
 Il tutorial LUA su lua-users è molto ben fatto e su HTTP://sf.net/projects/lua-u
sers potete trovare il LUA short reference che è un riassunto di tutte le
 funzioni standard LUA ed è anche un gran bel documento (mille grazie a
 Enrico Colombini).
 Se vi piace molto LUA dovreste comprare IL libro su LUA chiamato 
\emph on 

\begin_inset Quotes eld
\end_inset 

Programming in Lua
\begin_inset Quotes erd
\end_inset 


\emph default 
 di Roberto Ierusalimschy (consideratelo il K&R per LUA).
\layout Subsubsection

(step 3) Ottenere la lista dei messaggi
\layout Standard

Ora dovremo implementare la funzione 
\family typewriter 
stat()
\family default 
.
 La stat è probabilmente la funzione più importante.
 Essa deve prelevare la lista dei messaggi nella webmail, il loro UIDL e
 la loro grandezza.
 Nel nostro esempio useremo il modulo mlex per tirare fuori le informazioni
 importanti dalla pagina, ma potete usare il modulo per le stringhe di LUA
 per fare la stessa cosa con i capture.
 Questa è la nostra pagina inbox
\newline 

\begin_inset Graphics
	filename inbox.eps
	lyxscale 50
	scale 80

\end_inset 


\layout Standard

e questo è il corpo HTML (solo i primi due messaggi sono riportati)
\begin_inset ERT
status Collapsed

\layout Standard

\backslash 
linespread{0.5}
\layout Standard

\backslash 
begin{footnotesize}
\layout Standard

\backslash 
begin{verbatim}
\layout Standard
<h1>test@foo.xx - inbox (1/2)</h1> 
\layout Standard
<form name="inbox" method="post" action="/delete.php"> 
\layout Standard
<input type="hidden" name="session_id" value="ABCD1234"> 
\layout Standard
<table> 
\layout Standard
<tr><th>From</th><th>subject</th><th>size</th><th>date</th></tr> 
\layout Standard
<tr>        
\layout Standard
  <td><b>friend1@foo1.xx</b></td>         
\layout Standard
  <td><b><a href="/read.php?session_id=ABCD1234&uidl=123">ok!</a></b></td>
\layout Standard
  <td><b>20KB</b></td>
\layout Standard
  <td><b>today</b></td>   
\layout Standard
  <td><input type="checkbox" name="check_123"></td>
\layout Standard
</tr> 
\layout Standard
<tr>    
\layout Standard
  <td>friend2@foo2.xx</td>        
\layout Standard
  <td><a href="/read.php?session_id=ABCD1234&uidl=124">Re: hi!</a></td>  
\layout Standard
  <td>12KB</td>   
\layout Standard
  <td>yesterday</td>      
\layout Standard
  <td><input type="checkbox" name="check_124"></td> 
\layout Standard
</tr>
\layout Standard
</table> 
\layout Standard
<input type="submit" value="delete marked"> 
\layout Standard
</form> 
\layout Standard
<a href="/inbox.php?session_id=ABCD1234&page=2">go to next page</a> 
\layout Standard
</body> 
\layout Standard

\backslash 
end{verbatim}
\layout Standard

\backslash 
end{footnotesize}
\end_inset 

Abbiamo prelevato l'HTML usando il browser e il metodo
\family typewriter 
 get_uri()
\family default 
 (ricordate che la URI per l'inbox era nella pagina di login).
 Come vedete i messaggi sono in una tabella, e tale tabella ha la stessa
 struttura per ogni messaggio.
 Proprio questo è il posto in cui usare mlex.
 Semplicemente, prendete tutto ciò che c'è tra 
\family typewriter 
<tr>
\family default 
 e 
\family typewriter 
</tr>
\family default 
 di una riga di un messaggio e cancellate tutto tranne i nomi dei i tag.
 Poi sostituite tutti gli spazi vuoti (chiameremo spazio la stringa tra
 due tag) con un
\begin_inset Quotes eld
\end_inset 


\family typewriter 
.*
\family default 

\begin_inset Quotes erd
\end_inset 

.
 Ecco cosa abbiamo ottenuto (dovrebbe essere tutto sulla stessa riga, qui
 andiamo a capo per mancanza di spazio) dal primo messaggio.
\begin_inset ERT
status Collapsed

\layout Standard

\backslash 
linespread{0.5}
\layout Standard

\backslash 
begin{footnotesize}
\layout Standard

\backslash 
begin{verbatim}
\layout Standard
.*<tr>.*<td>.*<b>.*</b>.*</td>.*<td>.*<b>.*<a>.*</a>.*</b>.*</td>.*
\layout Standard
<td>.*<b>.*</b>.*</td>.*<td>.*<b>.*</b>.*</td>.*
\layout Standard
<td>.*<input>.*</td>.*</tr>
\layout Standard

\backslash 
end{verbatim}
\layout Standard

\backslash 
end{footnotesize}
\end_inset 

Questa espressione è usata per fare match con la riga della tabella che
 contiene informazioni sul messaggio.
 Ora copiate e incollate a parte la riga e sostituite ogni spazio e ogni
 tag con O (la lettera, non la cifra 0) o X.
 Mettete una X nei campi interessanti (nel nostro esempio la grandezza e
 il tag input, che contiene lo UIDL del messaggio).
\begin_inset ERT
status Collapsed

\layout Standard

\backslash 
linespread{0.5}
\layout Standard

\backslash 
begin{footnotesize}
\layout Standard

\backslash 
begin{verbatim}
\layout Standard
O<O>O<O>O<O>O<O>O<O>O<O>O<O>O<O>O<O>O<O>O<O>O
\layout Standard
<O>O<O>X<O>O<O>O<O>O<O>O<O>O<O>O
\layout Standard
<O>O<X>O<O>O<O>
\layout Standard

\backslash 
end{verbatim}
\layout Standard

\backslash 
end{footnotesize}
\end_inset 

Mentre la prima espressione verrà usata per fare match con la riga della
 tabella, questa verrà usata per estrarre i campi importanti.
 Questo codice lancia mlex sull'HTML e riempie la struttura dati popstate
 con i dati catturati.
\begin_inset ERT
status Collapsed

\layout Standard

\backslash 
linespread{0.5}
\layout Standard

\backslash 
begin{footnotesize}
\layout Standard

\backslash 
begin{verbatim}
\layout Standard
-- -------------------------------------------------------------------------- -- 
\layout Standard
-- Fill the number of messages and their size 
\layout Standard
function stat(pstate)
\layout Standard
      local file,err = nil, nil
\layout Standard
      local b = foo_globals.browser
\layout Standard
      file,err = b:get_uri("http://localhost:3000/inbox.php?session_id="..
\layout Standard
              foo_globals.session_id)
\layout Standard
      local e = ".*<tr>.*<td>.*<b>.*</b>.*</td>.*<td>.*<b>.*<a>"..               
\layout Standard
              ".*</a>.*</b>.*</td>.*<td>.*<b>.*</b>.*</td>.*<td>.*"..                
\layout Standard
              "<b>.*</b>.*</td>.*<td>.*<input>.*</td>.*</tr>"         
\layout Standard
      local g = "O<O>O<O>O<O>O<O>O<O>O<O>O<O>O<O>O<O>O<O>O<O>O"..              
\layout Standard
              "<O>O<O>X<O>O<O>O<O>O<O>O<O>O<O>O<O>O<X>O<O>O<O>"
\layout Standard
      local x = mlex.match(file,e,g) 
\layout Standard
      --debug print   
\layout Standard
      x:print()
\layout Standard

\layout Standard
      set_popstate_nummesg(pstate,x:count())
\layout Standard
      for i=1,x:count() do            
\layout Standard
              local _,_,size = string.find(x:get(0,i-1),"(%d+)")
\layout Standard
              local _,_,size_mult_k = string.find(x:get(0,i-1),"([Kk][Bb])")                        local _,_,size_mult_m = string.find(x:get(0,i-1),"([Mm][Bb])")
\layout Standard
              local _,_,uidl = string.find(x:get(1,i-1),"check_(%d+)")
\layout Standard
           
\layout Standard
              if size_mult_k ~= nil then
\layout Standard
                     size = size * 1024
\layout Standard
              end             
\layout Standard
              if size_mult_m ~= nil then
\layout Standard
                     size = size * 1024 * 1024
\layout Standard
              end             
\layout Standard
     
\layout Standard
              set_mailmessage_size(pstate,i,size)                     
\layout Standard
              set_mailmessage_uidl(pstate,i,uidl)
\layout Standard
      end
\layout Standard
 
\layout Standard
      return POPSERVER_ERR_OK
\layout Standard
end 
\layout Standard

\backslash 
end{verbatim}
\layout Standard

\backslash 
end{footnotesize}
\end_inset 

Il risultato di 
\family typewriter 
x:print()
\family default 
 è il seguente
\begin_inset ERT
status Collapsed

\layout Standard

\backslash 
linespread{0.5}
\layout Standard

\backslash 
begin{footnotesize}
\layout Standard

\backslash 
begin{verbatim}
\layout Standard
{'20KB','input type="checkbox" name="check_123"'}
\layout Standard

\backslash 
end{verbatim}
\layout Standard

\backslash 
end{footnotesize}
\end_inset 

e la sessione di telnet
\begin_inset ERT
status Collapsed

\layout Standard

\backslash 
linespread{0.5}
\layout Standard

\backslash 
begin{footnotesize}
\layout Standard

\backslash 
begin{verbatim}
\layout Standard
+OK FreePOPs/0.0.11 pop3 server ready 
\layout Standard
user test@foo.xx 
\layout Standard
+OK PLEASE ENTER PASSWORD 
\layout Standard
pass secret 
\layout Standard
+OK ACCESS ALLOWED 
\layout Standard
stat 
\layout Standard
+OK 1 20480 
\layout Standard
quit 
\layout Standard
+OK BYE BYE, UPDATING 
\layout Standard

\backslash 
end{verbatim}
\layout Standard

\backslash 
end{footnotesize}
\end_inset 

Non abbiamo indicato come abbiamo aggiunto la riga 
\family typewriter 
return
\family default 
 
\family typewriter 
POPSERVER_ERR_OK
\family default 
 alla funzione 
\family typewriter 
quit()
\family default 
.
 Il codice sorgente riportato sopra usa mlex per estrarre le due stringhe
 interessanti, poi la scorre cercando la grandezza, il suo moltiplicatore
 e lo UIDL.
 Di seguito imposta gli attributi dei messaggi.
 Potete vedere che abbiamo processato solo il primo messaggio.
 Per processare gli altri dobbiamo informare il modulo mlex che il tag 
 
\family typewriter 
<b>
\family default 
 è opzionale (potete notare che solo il primo messaggio è in grassetto).
 Quindi cambiamo le espressioni in
\begin_inset ERT
status Collapsed

\layout Standard

\backslash 
linespread{0.5}
\layout Standard

\backslash 
begin{footnotesize}
\layout Standard

\backslash 
begin{verbatim}
\layout Standard
.*<tr>.*<td>[.*]{b}.*{/b}[.*]</td>.*<td>[.*]{b}.*<a>.*</a>.*{/b}[.*]</td>.*
\layout Standard
<td>[.*]{b}.*{/b}[.*]</td>.*<td>[.*]{b}.*{/b}[.*]</td>.*
\layout Standard
<td>.*<input>.*</td>.*</tr>
\layout Standard

\backslash 
end{verbatim}
\layout Standard

\backslash 
end{footnotesize}
\end_inset 

e
\begin_inset ERT
status Collapsed

\layout Standard

\backslash 
linespread{0.5}
\layout Standard

\backslash 
begin{footnotesize}
\layout Standard

\backslash 
begin{verbatim}
\layout Standard
O<O>O<O>[O]{O}O{O}[O]<O>O<O>[O]{O}O<O>O<O>O{O}[O]<O>O
\layout Standard
<O>[O]{O}X{O}[O]<O>O<O>[O]{O}O{O}[O]<O>O
\layout Standard
<O>O<X>O<O>O<O>
\layout Standard

\backslash 
end{verbatim}
\layout Standard

\backslash 
end{footnotesize}
\end_inset 

Ora il comando stat risponde con 
\family typewriter 
+OK 4 45056
\family default 
 e la stampa di debug è 
\begin_inset ERT
status Collapsed

\layout Standard

\backslash 
linespread{0.5}
\layout Standard

\backslash 
begin{footnotesize}
\layout Standard

\backslash 
begin{verbatim}
\layout Standard
{'20KB','input type="checkbox" name="check_123"'} 
\layout Standard
{'12KB','input type="checkbox" name="check_124"'} 
\layout Standard
{'10KB','input type="checkbox" name="check_125"'} 
\layout Standard
{'2KB','input type="checkbox" name="check_126"'}
\layout Standard

\backslash 
end{verbatim}
\layout Standard

\backslash 
end{footnotesize}
\end_inset 

Ora abbiamo una vera e propria funzione stat che riempie la struttura dati
 popstate con le informazioni di cui il server POP necessita per rispondere
 ad una richiesta di stat.
 poiché le richieste list, uidl, list_all e uidl_all possono essere soddisfatte
 con gli stessi dati, useremo la funzione standard fornita dal modulo common.lua.
 Esso verrà spiegato nel prossimo passo, ma dobbiamo aggiungere due righe
 importanti alla funzione
\family typewriter 
stat()
\family default 
 per evitare una doppia chiamata.
\begin_inset ERT
status Collapsed

\layout Standard

\backslash 
linespread{0.5}
\layout Standard

\backslash 
begin{footnotesize}
\layout Standard

\backslash 
begin{verbatim}
\layout Standard
function stat(pstate) 
\layout Standard
       if foo_globals.stat_done == true then return POPSERVER_ERR_OK end
\layout Standard

\layout Standard
       ... the same code here ...
\layout Standard

\layout Standard
       foo_globals.stat_done = true
\layout Standard
       return POPSERVER_ERR_OK
\layout Standard
end
\layout Standard

\backslash 
end{verbatim}
\layout Standard

\backslash 
end{footnotesize}
\end_inset 


\layout Standard

La funzione più importante è pronta, ma dobbiamo fare delle precisazioni.
 Primo, mlex è molto comodo a volte, ma potreste trovare più utile la libreria
 per le stringhe di LUA o la libreria regualerexp (espressioni regolari
 estese posix) per raggiungere lo stesso scopo.
 Secondo, questa implementazione si ferma alla prima pagina di inbox.
 Dovreste visitare tutte le pagine di inbox, forse usando la funzione 
\family typewriter 
do_until()
\family default 
 nella libreria  
\family typewriter 
support.lua
\family default 
 (che descriveremo brevemente alla fine di questo tutorial).
 Terzo, non facciamo nessun controllo degli errori.
 Per esempio la variabile file può essere nil e dobbiamo controllare queste
 cose per fare un buon plugin.
\layout Subsubsection

(step 4) Le funzioni comuni
\layout Standard

Il modulo comune ci dà alcune funzioni precotte che dipendono solo da una
 
\family typewriter 
stat()
\family default 
 ben implementata (una stat che può essere chiamata più di una volta).
 Ecco la nostra implementazione di queste funzioni
\begin_inset ERT
status Collapsed

\layout Standard

\backslash 
linespread{0.5}
\layout Standard

\backslash 
begin{footnotesize}
\layout Standard

\backslash 
begin{verbatim}
\layout Standard
-- -------------------------------------------------------------------------- -- 
\layout Standard
-- Fill msg uidl field 
\layout Standard
function uidl(pstate,msg) return common.uidl(pstate,msg) end 
\layout Standard

\layout Standard
-- -------------------------------------------------------------------------- -- 
\layout Standard
-- Fill all messages uidl field 
\layout Standard
function uidl_all(pstate) return common.uidl_all(pstate) end 
\layout Standard

\layout Standard
-- -------------------------------------------------------------------------- -- 
\layout Standard
-- Fill msg size 
\layout Standard
function list(pstate,msg) return common.list(pstate,msg) end 
\layout Standard

\layout Standard
-- -------------------------------------------------------------------------- -- 
\layout Standard
-- Fill all messages size 
\layout Standard
function list_all(pstate) return common.list_all(pstate) end 
\layout Standard

\layout Standard
-- -------------------------------------------------------------------------- -- 
\layout Standard
-- Unflag each message merked for deletion 
\layout Standard
function rset(pstate) return common.rset(pstate) end
\layout Standard

\layout Standard
-- -------------------------------------------------------------------------- -- 
\layout Standard
-- Mark msg for deletion 
\layout Standard
function dele(pstate,msg) return common.dele(pstate,msg) end 
\layout Standard

\layout Standard
-- -------------------------------------------------------------------------- -- 
\layout Standard
-- Do nothing 
\layout Standard
function noop(pstate) return common.noop(pstate) end 
\layout Standard

\layout Standard

\backslash 
end{verbatim}
\layout Standard

\backslash 
end{footnotesize}
\end_inset 

ma prima aggiungete il codice per caricare il modulo comune alla vostra
 funzione 
\family typewriter 
init()
\family default 
.
\begin_inset ERT
status Collapsed

\layout Standard

\backslash 
linespread{0.5}
\layout Standard

\backslash 
begin{footnotesize}
\layout Standard

\backslash 
begin{verbatim}
\layout Standard
        ... the same code ..
\layout Standard

\layout Standard
        -- the common module    
\layout Standard
        if freepops.dofile("common.lua") == nil then
\layout Standard
                  return POPSERVER_ERR_UNKNOWN    
\layout Standard
        end 
\layout Standard

\layout Standard
        -- checks on globals    
\layout Standard
        freepops.set_sanity_checks()    
\layout Standard

\layout Standard
        return POPSERVER_ERR_OK 
\layout Standard
end 
\layout Standard

\backslash 
end{verbatim}
\layout Standard

\backslash 
end{footnotesize}
\end_inset 


\layout Subsubsection

(step 5) Cancellazione dei messaggi
\layout Standard

La cancellazione di un messaggio è solitamente un normale POST e un esempio
 di 
\family typewriter 
post_data
\family default 
 è 
\family typewriter 
session_id=ABCD1234&check_124=on&check_126=on
\family default 
.
 Il codice segue
\begin_inset ERT
status Collapsed

\layout Standard

\backslash 
linespread{0.5}
\layout Standard

\backslash 
begin{footnotesize}
\layout Standard

\backslash 
begin{verbatim}
\layout Standard
-- -------------------------------------------------------------------------- -- 
\layout Standard
-- Update the mailbox status and quit 
\layout Standard
function quit_update(pstate)
\layout Standard
      -- we need the stat
\layout Standard
      local st = stat(pstate)
\layout Standard
      if st ~= POPSERVER_ERR_OK then return st end
\layout Standard
         
\layout Standard
      -- shorten names, not really important  
\layout Standard
      local b = foo_globals.b         
\layout Standard
      local post_uri = b:wherearewe() .. "/delete.php"        
\layout Standard
      local session_id = foo_globals.session_id       
\layout Standard
      local post_data = "session_id=" .. session_id .. "&"
\layout Standard
    
\layout Standard
      -- here we need the stat, we build the uri and we check if we   
\layout Standard
      -- need to delete something     
\layout Standard
    
\layout Standard
      local delete_something = false; 
\layout Standard
      for i=1,get_popstate_nummesg(pstate) do                 
\layout Standard
             if get_mailmessage_flag(pstate,i,MAILMESSAGE_DELETE) then                                            post_data = post_data .. "check_" .. 
\layout Standard
                        get_mailmessage_uidl(pstate,i).. "=on&"                             
\layout Standard
                    delete_something = true                 
\layout Standard
             end     
\layout Standard
      end
\layout Standard
    
\layout Standard
      if delete_something then                
\layout Standard
             b:post_uri(post_uri,post_data)  
\layout Standard
      end
\layout Standard
    
\layout Standard
      return POPSERVER_ERR_OK 
\layout Standard
end 
\layout Standard

\backslash 
end{verbatim}
\layout Standard

\backslash 
end{footnotesize}
\end_inset 

Considerate che facciamo il POST solo se almeno un messaggio è segnato per
 la cancellazione.
 Un'altra cosa importante da tenere a mente è che fare un solo POST per
 tutti i messaggi è meglio che farne uno per ognuno.
 Quando possibile dovreste ridurre il numero di richieste HTTP al massimo
 dato che è qui che portiamo FreePOPs da lepre a tartaruga.
\layout Subsubsection

(step 6) Scaricare messaggi
\layout Standard

Potrete chiedervi perché parliamo di questo argomento solo al punto 6, d'altrond
e avere la posta è probabilmente ciò che volete da un plugin.
 Implementare la funzione 
\family typewriter 
retr()
\family default 
 è di solito facile.
 Dipende in realtà dalla webmail, ma qui parleremo del caso semplice, mentre
 alla fine del tutorial vedrete come gestire webmail complesse.
 Il caso base è quello in cui la webmail ha un pulsante per salvare i messaggi,
 e il messaggio salvato è un file di testo semplice che contiene sia l'header
 che il corpo del messaggio.
 Ci sono solo due questioni interessanti in questo caso, e cioè quelle relativa
 ai messaggi grandi al punto.
\layout Standard

I messaggi grandi causano timeout.
 Sì, il modo più semplice di scaricare un messaggio è chiamare 
\family typewriter 
b:get_uri()
\family default 
 e memorizzare il messaggio in una variabile, poi mandarlo al client di
 posta con 
\family typewriter 
popserver_callback()
\family default 
.
 Ma pensate che una mail da 5MB, scaricata con una connessione DSL da 640Kbps,
 alla piena velocità di 80KBps, impiega 64 secondi di download.
 Questo significa che il vostro plugin non manderà dati al client di posta
 per oltre un minuto, facendo sì che il client si disconnetta da FreePOPS
 pensando che il server POP3 sia morto.
 Per cui, dobbiamo mandare dati al client di posta appena possibile.
 Per questo abbiamo la funzione 
\family typewriter 
b:pipe_uri()
\family default 
 che chiama un callback ogni volta che ha dei dati freschi.
 Il codice seguente è la funzione di callback factory, che crea un nuovo
 callback da passare al metodo 
\family typewriter 
pipe_uri
\family default 
 del browser.
\begin_inset ERT
status Collapsed

\layout Standard

\backslash 
linespread{0.5}
\layout Standard

\backslash 
begin{footnotesize}
\layout Standard

\backslash 
begin{verbatim}
\layout Standard
-------------------------------------------------------------------------------- 
\layout Standard
-- The callback factory for retr 
\layout Standard
-- 
\layout Standard
function retr_cb(data)
\layout Standard
        local a = stringhack.new() 
\layout Standard
        return function(s,len)
\layout Standard
                s = a:dothack(s).."
\backslash 
0"          
\layout Standard
                popserver_callback(s,data)              
\layout Standard
                return len,nil
\layout Standard
        end
\layout Standard
end 
\layout Standard

\backslash 
end{verbatim}
\layout Standard

\backslash 
end{footnotesize}
\end_inset 

Qui potete vedere che il callback usa 
\family typewriter 
popserver_callback()
\family default 
 per passare dati al client di posta, ma prima di fare ciò manipola i dati
 con lo stringhack.
 Ma questa è la seconda questione interessante.
\layout Standard

Il protocollo POP3 deve terminare la risposta al comando retr con una riga
 che contiene solo tre byte, 
\begin_inset Quotes eld
\end_inset 


\family typewriter 
.
\backslash 
r
\backslash 
n
\family default 

\begin_inset Quotes erd
\end_inset 

.
 Ma che succede se una riga, dentro il corpo della mail, è un semplice punto?
 Dobbiamo cambiarlo in 
\begin_inset Quotes eld
\end_inset 


\family typewriter 
..
\backslash 
r
\backslash 
n
\family default 

\begin_inset Quotes erd
\end_inset 

.
 Non è cosi' difficile, una 
\family typewriter 
string.gsub(s,
\begin_inset Quotes erd
\end_inset 


\backslash 
r
\backslash 
n.
\backslash 
r
\backslash 
n
\begin_inset Quotes erd
\end_inset 

,
\begin_inset Quotes erd
\end_inset 


\backslash 
r
\backslash 
n..
\backslash 
r
\backslash 
n
\begin_inset Quotes erd
\end_inset 

)
\family default 
 è tutto ciò che ci serve...
 ma non nel caso dei callback.
 Il callback di invio verrà chiamato con dati freschi, e più di una volta
 se la mail è grande.
 E se il pattern cercato è troncato tra due chiamate il metodo 
\family typewriter 
string.gsub()
\family default 
 fallirà.
 Per questo il modulo stringhack ci viene incontro.
 L'oggetto 
\family typewriter 
a
\family default 
 vive fintantoché la funzione di callback viene chiamata (vedi il tutorial
 LUA) e terrà a mente che il pattern cercato può essere troncato.
\layout Standard

Infine, il codice della 
\family typewriter 
retr()
\family default 
.
\begin_inset ERT
status Collapsed

\layout Standard

\backslash 
linespread{0.5}
\layout Standard

\backslash 
begin{footnotesize}
\layout Standard

\backslash 
begin{verbatim}
\layout Standard
-- -------------------------------------------------------------------------- -- 
\layout Standard
-- Get message msg, must call  
\layout Standard
-- popserver_callback to send the data 
\layout Standard
function retr(pstate,msg,pdata)          
\layout Standard
        -- we need the stat
\layout Standard
        local st = stat(pstate)
\layout Standard
        if st ~= POPSERVER_ERR_OK then return st end 
\layout Standard
    
\layout Standard
        -- the callback
\layout Standard
        local cb = retr_cb(data) 
\layout Standard
     
\layout Standard
        -- some local stuff
\layout Standard
       local session_id = foo_globals.session_id
\layout Standard
       local b = internal_state.b
\layout Standard
       local uri = b:wherearewe() .. "/download.php?session_id="..session_id..
\layout Standard
                "&message="..get_mailmessage_uidl(pstate,msg) 
\layout Standard

\layout Standard
        -- tell the browser to pipe the uri using cb
\layout Standard
        local f,rc = b:pipe_uri(uri,cb)
\layout Standard
        if not f then
\layout Standard
                log.error_print("Asking for "..uri.."
\backslash 
n")
\layout Standard
                log.error_print(rc.."
\backslash 
n")
\layout Standard
                return POPSERVER_ERR_NETWORK
\layout Standard
        end
\layout Standard
end 
\layout Standard

\backslash 
end{verbatim}
\layout Standard

\backslash 
end{footnotesize}
\end_inset 


\layout Subsubsection

(step 7) Test
\layout Standard

Per fare un buon plugin ci vuole un sacco di testing.
 Dovreste cercare beta tester presso il forum di FreePOPs (HTTP://freepops.diludo
vico.it) e chiedere agli autori del software di includerlo nella distribuzione
 principale.
 Dovreste anche leggere il contratto della webmail, controllare se c'è qualcosa
 come 
\begin_inset Quotes eld
\end_inset 


\emph on 
Non userò mai un server webmail->pop3 per leggere la mia posta
\emph default 

\begin_inset Quotes erd
\end_inset 

 e inviare una copia agli autori del software.
\layout Subsubsection

(step 8) La tanto anticipata parte finale del tutorial
\layout Standard

Ci sono un sacco di cose che abbiamo tralasciato.
\layout Description

La\SpecialChar ~
multi-page\SpecialChar ~
stat è la vera buona implementazione per 
\family typewriter 
stat()
\family default 
.
 Abbiamo detto sopra che la nostra implementazione elenca solo i messaggi
 nella prima pagina.
 Il codice per il parsing e l'estrazione di informazioni interessanti da
 una pagina è già scritto, ci serve solo una funzione che controlli se siamo
 all'ultima pagina e se no cambi il valore di una variabile 
\family typewriter 
uri
\family default 
.
 La variabile  
\family typewriter 
uri
\family default 
 in questione sarà usata dalla funzione di prelevamento.
 In questo caso dovreste usare il modulo di supporto con il ciclo do_until.
 Questo è un semplice esempio di 
\family typewriter 
do_until()
\family default 
 
\begin_inset ERT
status Collapsed

\layout Standard

\backslash 
linespread{0.5}
\layout Standard

\backslash 
begin{footnotesize}
\layout Standard

\backslash 
begin{verbatim}
\layout Standard
-- -------------------------------------------------------------------------- -- 
\layout Standard
-- Fill the number of messages and their size 
\layout Standard
function stat(pstate)
\layout Standard
        ... some code as before ...
\layout Standard

\layout Standard
        -- this string will contain the uri to get. it may be updated by        
\layout Standard
        -- the check_f function, see later      
\layout Standard
        local uri = string.format(libero_string.first,popserver,session_id)
\layout Standard

\layout Standard
        -- The action for do_until      
\layout Standard
        --      
\layout Standard
        -- uses mlex to extract all the messages uidl and size  
\layout Standard
        local function action_f (s)
\layout Standard
                 -- calls match on the page s, with the mlexpressions
\layout Standard
                 -- statE and statG              
\layout Standard
                 local x = mlex.match(s,e,g)                 
\layout Standard
               
\layout Standard
                 -- the number of results                
\layout Standard
                 local n = x:count()
\layout Standard
                
\layout Standard
                 if n == 0 then return true,nil end
\layout Standard
 
\layout Standard
                 -- this is not really needed since the structure                
\layout Standard
                 -- grows automatically... maybe... don't remember now 
\layout Standard
                 local nmesg_old = get_popstate_nummesg(pstate)
\layout Standard
                 local nmesg = nmesg_old + n 
\layout Standard
                 set_popstate_nummesg(pstate,nmesg)
\layout Standard
      
\layout Standard
                 -- gets all the results and puts them in the popstate structure                              for i = 1,n do                        
\layout Standard
                         ... some code as before ...
\layout Standard
 
\layout Standard
                         set_mailmessage_size(pstate,i+nmesg_old,size)                     
\layout Standard
                         set_mailmessage_uidl(pstate,i+nmesg_old,uidl)           
\layout Standard
                 end     
\layout Standard
                
\layout Standard
                 return true,nil         
\layout Standard
        end
\layout Standard
        
\layout Standard
        -- check must control if we are not in the last page and        
\layout Standard
        -- eventually change uri to tell retrive_f the next page to retrive     
\layout Standard
        local function check_f (s)              
\layout Standard
                 local tmp1,tmp2 = string.find(s,next_check)              
\layout Standard
                 if tmp1 ~= nil then                     
\layout Standard
                          -- change retrive behaviour                     
\layout Standard
                          uri = "--build the uri for the next page--"
\layout Standard

\layout Standard
                          -- continue the loop
\layout Standard
                          return false       
\layout Standard
                 else
\layout Standard
                          return true
\layout Standard
                 end
\layout Standard
        end
\layout Standard

\layout Standard
        -- this is simple and uri-dependent
\layout Standard
        local function retrive_f ()
\layout Standard
                 local f,err = b:get_uri(uri)
\layout Standard
                 if f == nil then 
\layout Standard
                         return f,err
\layout Standard
                 end
\layout Standard
      
\layout Standard
                 local _,_,c = string.find(f,"--timeout string--")
\layout Standard
                 if c ~= nil then
\layout Standard
                         internal_state.login_done = nil                                
\layout Standard
                         session.remove(key())
\layout Standard
                         local rc = libero_login()                       
\layout Standard
                         if rc ~= POPSERVER_ERR_OK then                          
\layout Standard
                                 return nil,"Session ended,unable to recover"                                         end             
\layout Standard
                        
\layout Standard
                         uri = "--uri for the first page--"      
\layout Standard
                         return b:get_uri(uri)           
\layout Standard
                  end     
\layout Standard
               
\layout Standard
                  return f,err    
\layout Standard
        end
\layout Standard

\layout Standard
        -- initialize the data structure
\layout Standard
        set_popstate_nummesg(pstate,0)
\layout Standard
 
\layout Standard
        -- do it        
\layout Standard
        if not support.do_until(retrive_f,check_f,action_f) then
\layout Standard
                  log.error_print("Stat failed
\backslash 
n")
\layout Standard
                  session.remove(key())           
\layout Standard
                  return POPSERVER_ERR_UNKNOWN    
\layout Standard
        end
\layout Standard
        
\layout Standard
        -- save the computed values     
\layout Standard
        internal_state["stat_done"] = true 
\layout Standard
        return POPSERVER_ERR_OK 
\layout Standard
end 
\layout Standard

\backslash 
end{verbatim}
\layout Standard

\backslash 
end{footnotesize}
\end_inset 

Le uniche cose strane sono la funzione di prelevamento e quel che serve
 per salvare la sessione.
 Dato che le webmail a volte fanno timeout dovreste controllare se la pagina
 prelevata sia valida o no, ed eventualmente ritentare il login.
 Il salvataggio della sessione è la prossima questione.
\layout Description

Salvare\SpecialChar ~
la\SpecialChar ~
sessione è il modo per rendere FreePOPs davvero simile ad un browser.
 ciò significa che la prossima volta che controllate la posta FreePOPs ricariche
rà semplicemente la pagina inbox senza rifare il login.
 Per fare questo avete bisogno di una funzione 
\family typewriter 
key()
\family default 
 che crea un ID unico per ogni sessione
\begin_inset ERT
status Collapsed

\layout Standard

\backslash 
linespread{0.5}
\layout Standard

\backslash 
begin{footnotesize}
\layout Standard

\backslash 
begin{verbatim}
\layout Standard
-------------------------------------------------------------------------------- 
\layout Standard
-- The key used to store session info 
\layout Standard
-- 
\layout Standard
-- This key must be unique for all webmails, since the session pool is one  
\layout Standard
-- for all the webmails 
\layout Standard
-- 
\layout Standard
function key()
\layout Standard
        return foo_globals.username .. foo_globals.password
\layout Standard
end 
\layout Standard

\backslash 
end{verbatim}
\layout Standard

\backslash 
end{footnotesize}
\end_inset 

e una funzione di serializzazione  
\family typewriter 
foo_globals
\family default 

\begin_inset ERT
status Collapsed

\layout Standard

\backslash 
linespread{0.5}
\layout Standard

\backslash 
begin{footnotesize}
\layout Standard

\backslash 
begin{verbatim}
\layout Standard
-------------------------------------------------------------------------------- 
\layout Standard
-- Serialize the internal state 
\layout Standard
-- 
\layout Standard
-- serial.serialize is not enough powerful to correcly serialize the  
\layout Standard
-- internal state. The field b is the problem. b is an object. This means 
\layout Standard
-- that it is a table (and no problem for this) that has some field that are 
\layout Standard
-- pointers to functions. this is the problem. there is no easy way for the  
\layout Standard
-- serial module to know how to serialize this. so we call b:serialize  
\layout Standard
-- method by hand hacking a bit on names 
\layout Standard
-- 
\layout Standard
function serialize_state()   
\layout Standard
        internal_state.stat_done = false; 
\layout Standard
        return serial.serialize("foo_globals",foo_globals) ..            
\layout Standard
                internal_state.b:serialize("foo_globals.b") 
\layout Standard
end 
\layout Standard

\backslash 
end{verbatim}
\layout Standard

\backslash 
end{footnotesize}
\end_inset 

Ora dovete dire a FreePOPs di salvare lo stato nella funzione 
\family typewriter 
quit_update()
\family default 
 e caricarlo nella 
\family typewriter 
pass()
\family default 
.
 Questa è la nuova struttura 
\family typewriter 
pass()
\family default 

\begin_inset ERT
status Collapsed

\layout Standard

\backslash 
linespread{0.5}
\layout Standard

\backslash 
begin{footnotesize}
\layout Standard

\backslash 
begin{verbatim}
\layout Standard
function pass(pstate,password)  
\layout Standard
        -- save the password
\layout Standard
        internal_state.password = password
\layout Standard

\layout Standard
        -- eventually load session
\layout Standard
        local s = session.load_lock(key())
\layout Standard

\layout Standard
        -- check if loaded properly
\layout Standard
        if s ~= nil then
\layout Standard
                 -- "
\backslash 
a" means locked
\layout Standard
                 if s == "
\backslash 
a" then
\layout Standard
                          log.say("Session for "..internal_state.name..
\layout Standard
                              " is already locked
\backslash 
n")
\layout Standard
                          return POPSERVER_ERR_LOCKED
\layout Standard
                 end 
\layout Standard
     
\layout Standard
                 -- load the session
\layout Standard
                 local c,err = loadstring(s)
\layout Standard
                 if not c then
\layout Standard
                          log.error_print("Unable to load saved session: "..err)
\layout Standard
                          return foo_login()
\layout Standard
                 end     
\layout Standard
       
\layout Standard
                 -- exec the code loaded from the session string
\layout Standard
                 c()
\layout Standard

\layout Standard
                log.say("Session loaded for " .. internal_state.name .. "@" ..
\layout Standard
                         internal_state.domain ..
\layout Standard
                         "(" .. internal_state.session_id .. ")
\backslash 
n")      
\layout Standard

\layout Standard
                return POPSERVER_ERR_OK
\layout Standard
        else
\layout Standard
                -- call the login procedure
\layout Standard
                return foo_login()
\layout Standard
        end
\layout Standard
end 
\layout Standard

\backslash 
end{verbatim}
\layout Standard

\backslash 
end{footnotesize}
\end_inset 

dove 
\family typewriter 
foo_login()
\family default 
 è la vecchia funzione 
\family typewriter 
pass()
\family default 
 con cambiamenti minori.
 Non dimenticate di chiamare 
\family typewriter 
session.unlock(key())
\family default 
 nella funzione 
\family typewriter 
quit()
\family default 
, perché dovrete rilasciare la sessione in caso di fallimento (e  
\family typewriter 
quit()
\family default 
 viene chiamata qui) e salvare la sessione in 
\family typewriter 
quit_update()
\family default 

\begin_inset ERT
status Collapsed

\layout Standard

\backslash 
linespread{0.5}
\layout Standard

\backslash 
begin{footnotesize}
\layout Standard

\backslash 
begin{verbatim}
\layout Standard
-- save fails if it is already saved  
\layout Standard
session.save(key(),serialize_state(),session.OVERWRITE)
\layout Standard
-- unlock is useless if it have just been saved, but if we save
\layout Standard
-- without overwriting the session must be unlocked manually
\layout Standard
-- since it would fail instead overwriting
\layout Standard
session.unlock(key()) 
\layout Standard

\backslash 
end{verbatim}
\layout Standard

\backslash 
end{footnotesize}
\end_inset 


\layout Description

La\SpecialChar ~
funzione\SpecialChar ~
top() è piuttosto complessa.
 Non la descriveremo in modo completo, ma suggeriamo di guardare il plugin
  
\family typewriter 
libero.lua
\family default 
 se il server web che vi manda i messaggi supporta il campo 
\begin_inset Quotes eld
\end_inset 


\family typewriter 
Range:
\family default 

\begin_inset Quotes erd
\end_inset 

 nelle richieste HTTP, o il plugin HTTP request field, o il plugin 
\family typewriter 
tin.lua
\family default 
 se il server deve essere interrotto in malo modo.
 Ricordate che la 
\family typewriter 
top()
\family default 
 ha bisogno che qualcuno conti le righe e qui abbiamo di nuovo il modulo
 stringhack, che conta ed eventualmente elimina delle righe.
\layout Description

Il\SpecialChar ~
javascript è l'inferno delle webmail.
 I Javascript possono fare qualsiasi cosa e dovrete leggerli per emulare
 ciò che fanno.
 Per esempio potrebbero aggiungere alcuni cookie (e dovrete fare lo stesso
 a mano con
\family typewriter 
 b:add_cookie()
\family default 
 come in tin.lua) oppure possono cambiare alcuni campi di form (come nel
 codice  di bilanciamento del carico in  
\family typewriter 
libero.lua
\family default 
).
\layout Description

I\SpecialChar ~
cookie sono abbastanza appetibili per noi, visto che il modulo browser
 se ne occupa al posto nostro.
\layout Description

I\SpecialChar ~
file\SpecialChar ~
standard sono decisamente dipendenti dal sistema.
 Sotto Windows dovrete costantemente guardare 
\family typewriter 
stderr.txt
\family default 
 e 
\family typewriter 
stdout.txt
\family default 
, mentre sotto Unix dovrete solo lanciare FreePOPs con il parametro 
\family typewriter 
-w
\family default 
 e guardare la console.
\layout Description

La\SpecialChar ~
forza\SpecialChar ~
bruta si chiama Ethereal.
 A volte le cose non funzionano nel modo giusto e l'unico modo per fare
 debug è attivare curl debugging per vedere cosa fa FreePOPs (
\family typewriter 
b.curl:setopt(curl.OPT_VERBOSE,1)
\family default 
) e sniffare ciò che fa un vero browser con un tool come, appunto, Ethereal.
\layout Description

Il\SpecialChar ~
modo\SpecialChar ~
open\SpecialChar ~
source è il modo migliore di avere software di buona qualità.
 Questo significa che dovrete rilasciare molto spesso il vostro plugin nella
 fase di sviluppo e interagire molto con i vostri tester.
 Fidatevi, funziona, o leggete 
\begin_inset Quotes eld
\end_inset 


\emph on 
The cathedral and the bazaar
\emph default 

\begin_inset Quotes erd
\end_inset 

 di Eric Raymond.
\layout Description

Il\SpecialChar ~
modulo\SpecialChar ~
mimer è molto beta mentre scriviamo queste righe, ma è ciò di cui
 avete bisogno se siete nel caso sfortunato di una webmail che non ha un
 pulsante per salvare i messaggi.
 Il plugin 
\family typewriter 
lycos.lua
\family default 
 è un esempio di cosa può fare.
 La principale funzione interessante è 
\family typewriter 
mimer.pipe_msg()
\family default 
 che prende un header di messaggio, il testo del corpo (in html o testo
 semplice) e gli URI di alcuni attachment, scaricati al volo, composti in
 una vera e propria mail che viene inoltrata al client di posta.
\layout Description

Parametri\SpecialChar ~
per\SpecialChar ~
i\SpecialChar ~
moduli possono venire passati dal file 
\family typewriter 
config.lua
\family default 
 o al volo usando 
\family typewriter 
user@domain?pama1=value1&...&paramN=valueN
\family default 
 come descritto nel capitolo sui plugin.
 Per l'autore di plugin non c'è differenza tra i due metodi.
 I parametri sono disponibili per il plugin nella tabella 
\family typewriter 
freepops.MODULE_ARGS
\family default 
.
\layout Section

Segnalare un bug
\layout Standard

Quando avete problemi o pensate di avere trovato un bug, vi preghiamo di
 seguire alla lettera questo 
\emph on 
iter
\emph default 
:
\layout Enumerate

Aggiornate alla versione più recente di FreePOPs.
\layout Enumerate

Cercate di riprodurre il bug, se questo non è facilmente riproducibile siamo
 sfortunati.
 Si può ancora tentare qualcosa, se il software è andato in crash potreste
 compilarlo dai sorgenti, installare valgrind, lanciare freepopsd con valgrind
 e sperare che i messaggi d'errore siano interessanti.
\layout Enumerate

Pulite i file di log
\layout Enumerate

Lanciate FreePOPs con lo switch -w
\layout Enumerate

Riproducete il bug
\layout Enumerate

Inviate agli sviluppatori il log, più ogni altra informazione utile come
 che tipo di sistema avete e come riprodurre il bug.
\layout Section

FAQ
\layout Subsection*

Come si configura FreePOPs?
\layout Standard

In condizioni d'uso normali FreePOPs non si configura, basta cambiare le
 impostazioni del vostro client di posta come spiegato nel tutorial.
 Per altri casi abbiamo fornito tutorial specifici.
 Ricordate di impostare 
\emph on 
localhost
\emph default 
 come server POP3 (se avete installato FreePOPs sul computer da cui leggete
 la posta, altrimenti userete l'indirizzo IP del computer dove è installato
 FreePOPs), 
\emph on 
2000
\emph default 
 come porta (o un'altra che avrete scelto all'esecuzione di FreePOPs con
 l'opzione 
\emph on 
-p
\emph default 
) e di usare come nome utente il vostro indirizzo di posta completo (nella
 forma 
\family typewriter 
nomeutente@dominio.webmail
\family default 
).
 
\series bold 
Non
\series default 
 impostare l'uso di autenticazione per la connessione.
\layout Standard

Se avete dei problemi, leggete pure i nostri tutorial.
 Se continuate ad avere problemi, potete iscrivervi al forum su HTTP://freepops.d
iludovico.it (molto frequentato) e descrivere il vostro problema.
\layout Subsection*

FreePOPs si paga?
\layout Standard

FreePOPs è Free Software, è e rimarrà libero e gratuito.
 Lo potete scaricare gratuitamente dal sito, ma se i quattro amici che l'hanno
 creato vi stanno a cuore potete sempre inviargli una birretta chiedendo
 il loro indirizzo via mail, o una piccola donazione (effettuabile dal sito
 del progetto su SourceForge).
\layout Subsection*

Ho installato e configurato correttamente FreePOPs, ma non riesco comunque
 ad inviare messaggi, come posso fare?
\layout Standard

FreePOPs serve 
\series bold 
solo
\series default 
 per ricevere la posta elettronica.
 Per inviare messaggi dovete continuare ad utilizzare il server SMTP del
 provider con il quale vi collegate ad Internet.
 In questo modo non avrete nessun problema nell'invio di email.
 Per sapere a quale server SMTP fare riferimento guardate il sito web del
 vostro provider o chiamate il loro supporto tecnico.
\layout Subsection*

Perderò la mia mail? Il programma è beta!
\layout Standard

Nessuno garantisce il software che produce, e nessuno si assume responsabilità,
 tanto meno se il software non lo pagate.
 A noi pare abbastanza sicuro, ma non possiamo garantire niente (nessun
 software è assolutamente sicuro).
 Inoltre nessuno garantisce che il vostro client di mail funzioni bene,
 quindi se usate quello...
\layout Subsection*

Posso fare qualcosa per aiutare il progetto?
\layout Standard

Certo, i sorgenti sono disponibili.
 Mandateci pure patch e segnalateci i problemi che incontrate.
\layout Standard

Se il programma vi piace particolarmente potete anche contribuire con una
 piccola donazione (effettuabile dal sito del progetto su SourceForge).
\layout Standard

Quando volete segnalare un problema, assicuratevi prima che si verifichi
 anche nell'ultima versione rilasciata del programma (se non è quella che
 state usando).
 Consigliamo di disinstallare una vecchia versione prima di installarne
 una nuova.
 Inoltre ricordatevi di includere:
\layout Itemize

il numero della versione di FreePOPs che vi ha dato il problema
\layout Itemize

il sistema operativo su cui il problema si è presentato
\layout Itemize

il nome del client di posta che usi e se possibile il numero di versione
\layout Itemize

cosa più importante, il log di FreePOPs generato con l'opzione 
\series bold 
-vv
\series default 
 o 
\series bold 
-w
\series default 
 (guardate sotto se non sapete dove si trova e/o come aggiungere parametri
 alla riga di comando), controllando che non vi siano riportati dati personali
 che non volete rendere noti ad altri (gli autori del programma).
 Ma non preoccupatevi, la password non è mai scritta nei log se non come
 una sequenza di nove (9) asterischi (indipendentemente dalla sua reale
 lunghezza).
\layout Subsection*

Dove si trova il log di FreePOPs?
\layout Standard

La posizione del log di FreePOPs dipende dal sistema operativo in cui il
 programma viene eseguito.
 Su Linux, il log si trova in 
\emph on 
/var/log/freepops
\emph default 
 per default, o dove avete specificato con l'opzione 
\family typewriter 
-l
\family default 
.
 Su Windows, il log (file log.txt) si trova nella cartella dove avete installato
 FreePOPs o nel percorso da voi specificato se avete eseguito FreePOPs con
 il parametro
\family typewriter 
 -l
\family default 
.
\layout Standard

Prima di inviare il log assicuratevi che esso sia stato generato con l'opzione
 
\series bold 
-vv
\series default 
 (o 
\series bold 
-w
\series default 
) che sta per 
\begin_inset Quotes eld
\end_inset 

log verboso
\begin_inset Quotes erd
\end_inset 

.
 Questi parametri da riga di comando producono un log molto più dettagliato
 che ci permette di identificare più facilmente i problemi.
 Se necessario, cancellate il file di log esistente e riavviate FreePOPs
 aggiungendo uno di tali parametri alla riga di comando (guardate sotto):
 avrete così un log 
\begin_inset Quotes eld
\end_inset 

pulito
\begin_inset Quotes erd
\end_inset 

 che contiene solo la sessione fallita (se l'errore è riproducibile).
 Come sopra, cancellate informazioni che ritenete sensibili se non volete
 divulgarle.
\layout Subsection*

Come cambio i parametri della riga di comando di FreePOPs?
\layout Standard

Su sistemi basati su Unix vi basta aggiungere i parametri che volete al
 comando che usate per lanciare FreePOPs (forse da uno script).
\layout Standard

Sui vari Windows avete due possibilità: dal menu Start -> Programmi -> FreePOPs
 aprire la finestra delle proprietà del collegamento a FreePOPs (con il
 tasto destro del mouse e selezionando dal menu che apparirà la voce 
\begin_inset Quotes eld
\end_inset 

Proprietà...
\begin_inset Quotes erd
\end_inset 

) e aggiungere i parametri nella casella 
\begin_inset Quotes eld
\end_inset 

Destinazione
\begin_inset Quotes erd
\end_inset 

 (in coda a X:
\backslash 
Qualcosa
\backslash 
freepopsd.exe); oppure lanciare FreePOPs manualmente da una finestra DOS
 con i parametri che volete (sempre specificandoli dopo il nome dell'eseguibile).
\layout Standard

I parametri che vi servono dipendono dalle vostre esigenze.
 Leggete l'apposita sezione del manuale per conoscerli tutti o lanciate
 
\family typewriter 
freepopsd -h
\family default 
 (anche 
\family typewriter 
man freepopsd
\family default 
 su Unix).
\layout Itemize

Esempio Unix: 
\family typewriter 
/usr/bin/freepopsd -P proxy:porta -A user:pass -w -l logfile.txt
\layout Itemize

Esempio Windows: 
\family typewriter 
C:
\backslash 
Programmi
\backslash 
FreePOPs
\backslash 
freepopsd.exe -w
\layout Subsection*

Il mio 
\begin_inset Quotes eld
\end_inset 

Antivirus
\begin_inset Quotes erd
\end_inset 

 di fiducia dice che in FreePOPs c'è un virus, che devo fare?
\layout Standard

Smettere di usare quell'antivirus :-) A parte gli scherzi, FreePOPs NON
 contiene virus, cavalli di troia, worm, formule per riti demoniaci, piani
 segreti per il dominio del mondo né altro del genere.
 Se non credete a noi, i sorgenti sono disponibili a tutti (il programma
 è rilasciato sotto Licenza GNU GPL) e pensare di nascondere codice malevolo
 alla luce del sole sarebbe quantomeno folle.
 Pertanto un qualsiasi antivirus che rilevi problemi di questo tipo ha problemi
 di accuratezza, eufemisticamente parlando.
\layout Standard

Vero è che scaricare un eseguibile pre-compilato da una qualche fonte sconosciut
a è come andare in cerca di guai.
 I pacchetti pre-compilati che trovate sulle pagine ufficiali del progetto
 (HTTP://freepops.sf.net) provengono dai sorgenti che tutti possono vedere.
 Ciò che trovate su siti vari di software gratuito o che scaricate tramite
 sistemi di file sharing peer-to-peer, non può 
\emph on 
chiaramente
\emph default 
 offrire alcuna garanzia di sicurezza.
 Per cui usate un po' di buon senso.
 
\layout Section

Autori
\layout Standard

Questo manuale è stato scritto da Enrico Tassi 
\family typewriter 
<gareuselesinge@users.sourceforge.net>
\family default 
 e rivisto e tradotto da Nicola Cocchiaro 
\family typewriter 
<ncocchiaro@users.sourceforge.net>
\layout Subsection

Sviluppatori
\layout Standard

FreePOPs è sviluppato da:
\layout Itemize

Enico Tassi 
\family typewriter 
<gareuselesinge@users.sourceforge.net>
\layout Itemize

Alessio Caprari 
\family typewriter 
<alessiofender@users.sourceforge.net>
\layout Itemize

Nicola Cocchiaro 
\family typewriter 
<ncocchiaro@users.sourceforge.net>
\layout Itemize

Simone Vellei 
\family typewriter 
<simone_vellei@users.sourceforge.net>
\layout Standard

Gmail.lua è sviluppato da:
\layout Itemize

Rami Kattan <
\family typewriter 
rkattan@gmail.com
\family default 
> 
\newline 
HTTP://www.kattanweb.com/rami
\layout Standard

LiberoPOPs è sviluppato da:
\layout Itemize

Enico Tassi 
\family typewriter 
<gareuselesinge@users.sourceforge.net>
\layout Itemize

Alessio Caprari 
\family typewriter 
<alessiofender@users.sourceforge.net>
\layout Itemize

Nicola Cocchiaro 
\family typewriter 
<ncocchiaro@users.sourceforge.net>
\layout Itemize

Simone Vellei 
\family typewriter 
<simone_vellei@users.sourceforge.net>
\layout Itemize

Giacomo Tenaglia 
\family typewriter 
<sonicsmith@users.sourceforge.net>
\layout Section

Ringraziamenti
\layout Standard

Ringraziamenti speciali vanno agli utenti che hanno testato il software,
 agli hacker che hanno reso possibile avere un ambiente di sviluppo affidabile
 e libero come il sistema Debian GNU/Linux.
\layout Section*

Appendice
\layout Standard

Poiché la tabella ASCII è molto comune, non l'abbiamo inclusa qui.
 Potete chiedere a google.
 L'unica cosa che può suonare strana è che usiamo sempre tre cifre, anche
 per numeri minori di 100.
\the_end
