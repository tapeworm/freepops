diff -ruN pthreads-20030918-old/Makefile pthreads-20030918/Makefile
--- pthreads-20030918-old/Makefile	2003-11-08 00:51:12.000000000 +0100
+++ pthreads-20030918/Makefile	2004-01-28 17:16:41.000000000 +0100
@@ -1,79 +1,19 @@
-#
-# --------------------------------------------------------------------------
-#
-#      Pthreads-win32 - POSIX Threads Library for Win32
-#      Copyright(C) 1998 John E. Bossom
-#      Copyright(C) 1999,2003 Pthreads-win32 contributors
-# 
-#      Contact Email: rpj@callisto.canberra.edu.au
-# 
-#      The current list of contributors is contained
-#      in the file CONTRIBUTORS included with the source
-#      code distribution. The list can also be seen at the
-#      following World Wide Web location:
 #      http://sources.redhat.com/pthreads-win32/contributors.html
-# 
-#      This library is free software; you can redistribute it and/or
-#      modify it under the terms of the GNU Lesser General Public
-#      License as published by the Free Software Foundation; either
-#      version 2 of the License, or (at your option) any later version.
-# 
-#      This library is distributed in the hope that it will be useful,
-#      but WITHOUT ANY WARRANTY; without even the implied warranty of
-#      MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-#      Lesser General Public License for more details.
-# 
-#      You should have received a copy of the GNU Lesser General Public
-#      License along with this library in the file COPYING.LIB;
-#      if not, write to the Free Software Foundation, Inc.,
-#      59 Temple Place - Suite 330, Boston, MA 02111-1307, USA
-#
-
-ifeq "CYGWIN_NT-5.1" "$(shell uname)"
-	gcc=gcc
-	gpp=g++
-	DLLTOOL=dlltool
-	EXTRA=-L /usr/lib/mingw -lmingw32 -lmsvcrt
-else
-	gcc=/usr/local/cross-tools/i386-mingw32msvc/bin/gcc
-	gpp=/usr/local/cross-tools/i386-mingw32msvc/bin/g++
-	DLLTOOL=/usr/local/cross-tools/i386-mingw32msvc/bin/dlltool
-endif
 
-DEVROOT	= C:\PTHREADS
+include $(CONFIG)
 
-DLLDEST	= $(DEVROOT)\DLL
-LIBDEST	= $(DEVROOT)\DLL
+LIBRARY=lib$(TARGET)$(STATICEXTENSION)
+LIBRARY_DLL=lib$(TARGET)$(SHAREDEXTENSION)
 
-# If Running MsysDTK
 RM	= rm -f
 MV	= mv -f
 CP	= cp -f
 
-# If not.
-#RM	= erase
-#MV	= rename
-#CP	= copy
-
-AR	= /usr/local/cross-tools/i386-mingw32msvc/bin/ar
-
-#OPT	= -g
-#OPT	= -O3 -DTEST_ICE
-
 OPT	= -O3 -finline-functions -mwindows -mno-cygwin -mms-bitfields
-#OPT	= -O3 -finline-functions -mwindows -mno-cygwin -fnative-struct
 
-LFLAGS		= -lwsock32 $(EXTRA)
+LFLAGS		= -lwsock32 #$(EXTRA)
 
-GC_CFLAGS	= -D__CLEANUP_C
-GCE_CFLAGS	= -D__CLEANUP_CXX -mthreads
-
-## Mingw32
-MAKE		= make
-CFLAGS	= $(OPT) -I. -D_WIN32_WINNT=0x400 -DHAVE_CONFIG_H -Wall
-
-## Cygwin G++
-#CFLAGS	= $(OPT) -x $(GLANG) -fhandle-exceptions -D_WIN32_WINNT=0x400 -I. -DHAVE_CONFIG_H -Wall
+CFLAGS	= $(OPT) -I. -D__CLEANUP_C -D_WIN32_WINNT=0x400 -DHAVE_CONFIG_H -Wall
 
 DLL_INLINED_OBJS	= \
 		pthread.o
@@ -399,92 +338,40 @@
 		pthread_setspecific.c \
 		pthread_getspecific.c
 
+all: $(LIBRARY)
+
+$(LIBRARY): $(DLL_OBJS)
+	@echo -n " linking "
+	@$(DLLTOOL) -e exports.o -l lib$(TARGET).lib $(DLL_OBJS)
+	@$(CC) $(OPT) -shared -o $(LIBRARY_DLL) exports.o $(DLL_OBJS) $(LFLAGS)
+	@#$(DLLTOOL) -z lib$(TARGET).def $(DLL_OBJS) exports.o
+	@#$(DLLTOOL) -k --dllname $(LIBRARY_DLL) --output-lib $(LIBRARY) --def lib$(TARGET).def
+	@#$(RANLIB) $(LIBRARY)
+	@echo "$(LIBRARY)"
+	@cp pthread.h sched.h semaphore.h $(PREFIX)/include
+	@cp $(LIBRARY_DLL) $(PREFIX)/lib
+
+clean:
+	@-$(RM) *~
+	@$(RM) *.i
+	@$(RM) *.o
+	@$(RM) $(LIBRARY)
 
-GCE_DLL	= pthreadGCE.dll
-GCE_LIB	= libpthreadGCE.a
-GCE_INLINED_STAMP = pthreadGCE.stamp
-
-GC_DLL 	= pthreadGC.dll
-GC_LIB	= libpthreadGC.a
-GC_INLINED_STAMP = pthreadGC.stamp
-
-PTHREAD_DEF	= pthread.def
-
-help:
-	@ echo "Run one of the following command lines:"
-	@ echo "make clean GCE           (to build the GNU C dll with C++ exception handling)"
-	@ echo "make clean GC            (to build the GNU C dll with C cleanup code)"
-	@ echo "make clean GCE-inlined   (to build the GNU C inlined dll with C++ exception handling)"
-	@ echo "make clean GC-inlined    (to build the GNU C inlined dll with C cleanup code)"
-
-all:
-	@ $(MAKE) clean GCE
-	@ $(MAKE) clean GC
-
-GC:
-		$(MAKE) CC=$(gcc) CLEANUP_FLAGS="$(GC_CFLAGS)" OBJ="$(DLL_OBJS)" $(GC_DLL)
-
-GCE:
-		$(MAKE) CC=$(gpp) CLEANUP_FLAGS="$(GCE_CFLAGS)" OBJ="$(DLL_OBJS)" $(GCE_DLL)
-
-GC-inlined:
-		$(MAKE) CC=$(gcc) CLEANUP_FLAGS="$(GC_CFLAGS)" OBJ="$(DLL_INLINED_OBJS)" $(GC_INLINED_STAMP)
-
-GCE-inlined:
-		$(MAKE) CC=$(gpp) CLEANUP_FLAGS="$(GCE_CFLAGS)" OBJ="$(DLL_INLINED_OBJS)" $(GCE_INLINED_STAMP)
-
-tests:
-	@ cd tests
-	@ $(MAKE) auto
 
 %.pre: %.c
-	$(CC) -E -o $@ $(CFLAGS) $^
+	@$(CC) -E -o $@ $(CFLAGS) $^
 
 %.s: %.c
-	$(CC) -c $(CFLAGS) -Wa,-ahl $^ > $@
+	@echo " building dep for $<"
+	@$(CC) -c $(CFLAGS) -Wa,-ahl $^ > $@
 
 .SUFFIXES: .dll .c .o
 
-.c.o:;		 $(CC) -c -o $@ $(CFLAGS) $(CLEANUP_FLAGS) $<
-
+%.o:%.c		 
+	@echo -n " compiling $< -> "
+	@$(CC) -c -o $@ $(CFLAGS) $(CLEANUP_FLAGS) $<
+	@echo "$@"
 
-$(GC_DLL): $(DLL_OBJS)
-	$(CC) $(OPT) -shared -o $(GC_DLL) $(DLL_OBJS) $(LFLAGS)
-	$(DLLTOOL) -z pthread.def $(DLL_OBJS)
-	$(DLLTOOL) -k --dllname $@ --output-lib $(GC_LIB) --def $(PTHREAD_DEF)
-
-$(GCE_DLL): $(DLL_OBJS)
-	$(CC) $(OPT) -mthreads -shared -o $(GCE_DLL) $(DLL_OBJS) $(LFLAGS)
-	$(DLLTOOL) -z pthread.def $(DLL_OBJS)
-	$(DLLTOOL) -k --dllname $@ --output-lib $(GCE_LIB) --def $(PTHREAD_DEF)
-
-$(GC_INLINED_STAMP): $(DLL_INLINED_OBJS)
-	$(CC) $(OPT) -shared -o $(GC_DLL) $(DLL_INLINED_OBJS) $(LFLAGS)
-	$(DLLTOOL) -z pthread.def $(DLL_INLINED_OBJS)
-	$(DLLTOOL) -k --dllname $(GC_DLL) --output-lib $(GC_LIB) --def $(PTHREAD_DEF)
-	echo touched > $(GC_INLINED_STAMP)
-
-$(GCE_INLINED_STAMP): $(DLL_INLINED_OBJS)
-	$(CC) $(OPT) -mthreads -shared -o $(GCE_DLL) $(DLL_INLINED_OBJS)  $(LFLAGS)
-	$(DLLTOOL) -z pthread.def $(DLL_INLINED_OBJS)
-	$(DLLTOOL) -k --dllname $(GCE_DLL) --output-lib $(GCE_LIB) --def $(PTHREAD_DEF)
-	echo touched > $(GCE_INLINED_STAMP)
-
-clean:
-	-$(RM) *~
-	-$(RM) *.i
-	-$(RM) *.o
-	-$(RM) *.obj
-	-$(RM) *.exe
-	-$(RM) $(PTHREAD_DEF)
-
-realclean: clean
-	-$(RM) $(GC_LIB)
-	-$(RM) $(GCE_LIB)
-	-$(RM) $(GC_DLL)
-	-$(RM) $(GCE_DLL)
-	-$(RM) $(GC_INLINED_STAMP)
-	-$(RM) $(GCE_INLINED_STAMP)
 
 attr.o:		attr.c $(ATTR_SRCS) $(INCL)
 barrier.o:	barrier.c $(BARRIER_SRCS) $(INCL)
diff -ruN pthreads-20030918-old/config.h pthreads-20030918/config.h
--- pthreads-20030918-old/config.h	2003-09-12 15:18:04.000000000 +0200
+++ pthreads-20030918/config.h	2004-01-28 17:16:41.000000000 +0100
@@ -4,7 +4,7 @@
 #define PTW32_CONFIG_H
 
 /* We're building the pthreads-win32 library */
-#define PTW32_BUILD
+//#define PTW32_BUILD
 
 /* Do we know about the C type sigset_t? */
 #undef HAVE_SIGSET_T
diff -ruN pthreads-20030918-old/pthread.h pthreads-20030918/pthread.h
--- pthreads-20030918-old/pthread.h	2003-11-01 10:45:28.000000000 +0100
+++ pthreads-20030918/pthread.h	2004-01-28 17:16:41.000000000 +0100
@@ -489,13 +489,7 @@
  * do NOT define PTW32_BUILD, and then the variables/functions will
  * be imported correctly.
  */
-#ifdef _DLL
-#  ifdef PTW32_BUILD
-#    define PTW32_DLLPORT __declspec (dllexport)
-#  else
-#    define PTW32_DLLPORT __declspec (dllimport)
-#  endif
-#endif
+#define PTW32_DLLPORT extern
 
 #if defined(_UWIN) && PTW32_LEVEL >= PTW32_LEVEL_MAX
 #   include	<sys/types.h>
diff -ruN pthreads-20030918-old/sched.h pthreads-20030918/sched.h
--- pthreads-20030918-old/sched.h	2003-11-01 10:47:46.000000000 +0100
+++ pthreads-20030918/sched.h	2004-01-28 17:18:03.000000000 +0100
@@ -76,11 +76,7 @@
  * do NOT define PTW32_BUILD, and then the variables/functions will
  * be imported correctly.
  */
-#ifdef PTW32_BUILD
-# define PTW32_DLLPORT __declspec (dllexport)
-#else
-# define PTW32_DLLPORT __declspec (dllimport)
-#endif
+#define PTW32_DLLPORT extern
 
 /*
  * This is a duplicate of what is in the autoconf config.h,
diff -ruN pthreads-20030918-old/semaphore.h pthreads-20030918/semaphore.h
--- pthreads-20030918-old/semaphore.h	2003-12-06 16:49:22.000000000 +0100
+++ pthreads-20030918/semaphore.h	2004-01-28 17:19:10.000000000 +0100
@@ -75,11 +75,7 @@
  * do NOT define PTW32_BUILD, and then the variables/functions will
  * be imported correctly.
  */
-#ifdef PTW32_BUILD
-# define PTW32_DLLPORT __declspec (dllexport)
-#else
-# define PTW32_DLLPORT __declspec (dllimport)
-#endif
+# define PTW32_DLLPORT extern
 
 
 /*
